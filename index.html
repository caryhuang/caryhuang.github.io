<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Cary&#39;s Blog</title>


    <meta property="og:type" content="website">
<meta property="og:title" content="Cary&#39;s Blog">
<meta property="og:url" content="http://caryhuang.github.io/index.html">
<meta property="og:site_name" content="Cary&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://caryhuang.github.io/images/og_image.png">
<meta property="article:author" content="Cary Huang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://caryhuang.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="Cary's Blog" type="application/atom+xml">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/Simplicity-design-logo.jpg" alt="Cary&#39;s Blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about/me.html">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/10/28/Cross-partition-uniqueness-guarantee-with-global-unique-index/" class="image is-7by1">
            <img class="thumbnail" src="/images/gunique.png" alt="Cross-partition uniqueness guarantee with global unique index">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-10-28T18:18:03.000Z">2022-10-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 977 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/10/28/Cross-partition-uniqueness-guarantee-with-global-unique-index/">Cross-partition uniqueness guarantee with global unique index</a>
            
        </h1>
        <div class="content">
            <h3 id="1-0-Introduction"><a href="#1-0-Introduction" class="headerlink" title="1.0 Introduction"></a>1.0 Introduction</h3><p>My colleague, David, recently published a post <a href="https://www.highgo.ca/2022/10/14/global-index-a-different-approach/">“Global Index, a different approach”</a> that describes the work that we are doing to implement global unique index in an approach that does not change current PostgreSQL’s partitioning framework, while allowing cross-partition uniqueness constraint. To implement this, we must first know how PostgreSQL currently ensures uniqueness on a single table with a unique index and then we expand on top of this logic to support cross-partition uniqueness check. This blog of mine <a href="https://www.highgo.ca/2022/09/30/how-unique-index-works-in-pg/">here</a> has a rough overview how unique index works in PG. In this blog, I would like to describe the approach we take to ensure cross-partition uniqueness check during index creation in both serial and parallel build.</p>
<h3 id="2-0-Cross-Partition-Uniqueness-Check-in-Serial-Global-Unique-Index-Build"><a href="#2-0-Cross-Partition-Uniqueness-Check-in-Serial-Global-Unique-Index-Build" class="headerlink" title="2.0 Cross-Partition Uniqueness Check in Serial Global Unique Index Build"></a>2.0 Cross-Partition Uniqueness Check in Serial Global Unique Index Build</h3><p>As described in this blog <a href="ttps://www.highgo.ca/2022/09/30/how-unique-index-works-in-pg/">here</a>, uniqueness is guaranteed by doing a heap scan on a table and sorting the tuples inside one or two BTSpool structures. If 2 tuples with the same scan key are sorted right next to each other, uniqueness violation is found and system errors out. For example, building a global unique index on a partitioned table containing 6 partitions, at least 6 differnt BTSpool will be filled and used to determine uniqueness violation within each partition creation. So if a duplicate exists in another partition, PG currently cannot detect that. So, in theory if we introduce another BTSpool at a global scale that is visible to all partitions and lives until all partitions have been scanned, we can put all index tuples from all partitions in this global spool and determine cross-partition uniqueness simply by sorting it when the last partition scan is finished</p>
<p>This diagram below illustrates the position of the new global level BTSpool (called spool3) and how it can be used to determine cross-partition uniqueness.</p>
<p><img src="/images/global-index-1.drawio.png" alt=""></p>
<p>Cross-partition uniqueness check in action:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart (a <span class="built_in">int</span>, b <span class="built_in">int</span>, c <span class="built_in">text</span>) <span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span> (a);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart1 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">0</span>) <span class="keyword">to</span> (<span class="number">100000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart2 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">100001</span>) <span class="keyword">to</span> (<span class="number">200000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart3 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">200001</span>) <span class="keyword">to</span> (<span class="number">300000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart4 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">300001</span>) <span class="keyword">to</span> (<span class="number">400000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart5 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">400001</span>) <span class="keyword">to</span> (<span class="number">500000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> globalidxpart6 <span class="keyword">partition</span> <span class="keyword">of</span> globalidxpart <span class="keyword">for</span> <span class="keyword">values</span> <span class="keyword">from</span> (<span class="number">500001</span>) <span class="keyword">to</span> (<span class="number">600000</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> globalidxpart (a, b, c) <span class="keyword">values</span> (<span class="number">42</span>, <span class="number">572814</span>, <span class="string">'inserted first on globalidxpart1'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> globalidxpart (a, b, c) <span class="keyword">values</span> (<span class="number">150000</span>, <span class="number">572814</span>, <span class="string">'inserted duplicate b on globalidxpart2'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> globalidxpart (a, b, c) <span class="keyword">values</span> (<span class="number">550000</span>, <span class="number">572814</span>, <span class="string">'inserted duplicate b on globalidxpart6'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> <span class="keyword">on</span> globalidxpart (b) <span class="keyword">global</span>; </span><br><span class="line">ERROR:  could not <span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> <span class="string">"globalidxpart1_b_idx"</span></span><br><span class="line">DETAIL:  <span class="keyword">Key</span> (b)=(<span class="number">572814</span>) <span class="keyword">is</span> duplicated.</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> globalidxpart <span class="keyword">where</span> a = <span class="number">150000</span> <span class="keyword">and</span> b = <span class="number">572814</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> <span class="keyword">on</span> globalidxpart (b) <span class="keyword">global</span>;</span><br><span class="line">ERROR:  could not <span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> <span class="string">"globalidxpart1_b_idx"</span></span><br><span class="line">DETAIL:  <span class="keyword">Key</span> (b)=(<span class="number">572814</span>) <span class="keyword">is</span> duplicated.</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> globalidxpart <span class="keyword">where</span> a = <span class="number">42</span> <span class="keyword">and</span> b = <span class="number">572814</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> <span class="keyword">on</span> globalidxpart (b) <span class="keyword">global</span>; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span></span><br></pre></td></tr></table></figure>

<h4 id="Some-Considerations"><a href="#Some-Considerations" class="headerlink" title="Some Considerations"></a>Some Considerations</h4><p>How many index tuples can this new global BTSpool hold? Since it needs to hold tuples from all partitions, does it need a lot of memory space allocated? </p>
<p>It uses <code>maintenance_work_mem</code> from <code>postgresql.conf</code>, same as BTSpool1. When it is near capacity, it will start to write tuples on disk as temporary files (also refer to as logical tapes within PostgreSQL, more on this later) instead of in the memory. So the spool can actually hold much more tuples than we thought. Before the final sorting, we will have to do a final <code>merge</code> of all the logical tapes that PG has written out on disk if memory is not enough to hold all tuples, then do a final <code>merge sort</code> to determine uniqueness. </p>
<h3 id="3-0-Cross-Partition-Uniqueness-Check-in-Parallel-Global-Unique-Index-Build"><a href="#3-0-Cross-Partition-Uniqueness-Check-in-Parallel-Global-Unique-Index-Build" class="headerlink" title="3.0 Cross-Partition Uniqueness Check in Parallel Global Unique Index Build"></a>3.0 Cross-Partition Uniqueness Check in Parallel Global Unique Index Build</h3><p>Cross-partition uniqueness check using a global-scale spool is very straight forward in serial index build case. </p>
<p>PG’s current parallel sorting is much more complex as it uses <code>logical tapes</code> to share and merge intermediate sorted results written on disk as temporary files by each workers. At the final sorting, the leader process take over all logical tapes written out by workers and perform final merge sort to determine uniqueness. </p>
<p>For example, if 3 workers (one of them being the leader) are requested to build a single partition’s index, there will be 3 logical tapes (or 3 temporary files) written out on disk (each being intermediately sorted by each worker before written). The workers use shared memory to coordiate with each other such that they do not write to the same tape files and overwrite each other. When all workers finish, the leader will “Take over all logical tapes”, merge the tapes and perform a final sort. When done, PG will destroy all the parallel workers, which in turn will destroy all logical tape files on disk before moving on to the next partition.</p>
<p>So, to achieve cross-partition check in parallel, we have to retain those logical tape files when we finish sorting one partition. Currently PG will destroy them when a partition’s index build is finished in parallel. If number of worker spawned is X and number of partition is Y, at the last partition build finish, we should have X * Y logical tapes on disk that we need to do merge sort on. We still use a separate spool3 to manage the tapes and persist them until all partitions are finished.</p>
<p>This diagram below illustrates the position of spool3 and how it can be used to determine cross-partition uniqueness in parallel.</p>
<p><img src="/images/global-index-parallel-build.drawio.png" alt=""></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-09-30T17:10:45.000Z">2022-09-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 778 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/09/30/How-Unique-Index-Works-In-PG-and-the-possibility-of-cross-partition-uniqueness-guarantee/">How Unique Index Works in PG</a>
            
        </h1>
        <div class="content">
            <h3 id="1-0-Introduction"><a href="#1-0-Introduction" class="headerlink" title="1.0 Introduction"></a>1.0 Introduction</h3><p>Recently I have been involved in creating a solution that guarantees cross-partition uniqueness within a partitioned table consisting multiple child tables. Some people refer to this feature as a global index and there has been some discussion about it in the email thread <a href="https://www.postgresql.org/message-id/flat/CALtqXTcurqy1PKXzP9XO%3DofLLA5wBSo77BnUnYVEZpmcA3V0ag%40mail.gmail.com">here</a>. Though the idea is good, the approach sparks a lot of controvercies as the approach changes how partitioned indexes are stored. It basically store all partitioned index together as one and uses TableOid as a key to reference internally. My team and I are experimenting an alternative approach that guarantees cross-partition uniqueness without changing the fundamentals, but before we can do that, we have to understand how uniqueness works in partitioned tables in PG.</p>
<h3 id="2-0-CREATE-INDEX-Uniqueness-Guarantee"><a href="#2-0-CREATE-INDEX-Uniqueness-Guarantee" class="headerlink" title="2.0 CREATE INDEX Uniqueness Guarantee"></a>2.0 CREATE INDEX Uniqueness Guarantee</h3><p>PG follows this basic procedure to check uniqueness violations</p>
<ol>
<li><p>perform a heap scan on the target child partition table</p>
</li>
<li><p>store the visible tuples into a <code>BTSpool</code> structure (spool1) and dead tuples into another <code>BTSpool</code> structure (spool2), so there are 2 BTSpool structures used and spool2 can be NULL if a table has no dead tuples or uniqueness is not required. A spool structure can be understood as a collection of index tuples.</p>
</li>
<li><p>perform sort on spool1 and spool2 if available</p>
</li>
<li><p>the sorting algorithm is equipped with duplicate detection, if two of the same tuples are subsequently sorted together, a duplicate is found and will raise Error here if uniqueness is required.</p>
</li>
<li><p>if no duplicate is found from sorting, PG will build the index tree based on spool1 and spool2</p>
</li>
<li><p>Destroy all the spools when index creation is done</p>
</li>
<li><p>This logic is located in btbuild() function within <code>src/backend/access/nbtree/nbtsort.c</code> and is invoked from DefineIndex function in indexcmds.c. btbuild will be called multiple times from DefineIndex depending on the number of active child partition tables.</p>
</li>
</ol>
<h3 id="3-0-INSERT-And-UPDATE-Uniqueness-Guarantee"><a href="#3-0-INSERT-And-UPDATE-Uniqueness-Guarantee" class="headerlink" title="3.0 INSERT And UPDATE Uniqueness Guarantee"></a>3.0 INSERT And UPDATE Uniqueness Guarantee</h3><p>At planner and optimizer stage, PG already know which child partition table the new data should be inserted or updated to</p>
<ol>
<li><p>PG will first inserts the heap tuple in target heap relation.</p>
</li>
<li><p>then it will attempt to insert new index tuples associated with the heap tuple by calling <code>_bt_doinsert()</code> in src/backend/access/nbtree/nbtinsert.c</p>
</li>
<li><p>when uniqueness check is required by the index, PG will construct a scan key from the new heap tuple and try to fetch an existing matching tuple from the heap partition table by calling <code>_bt_check_unique()</code></p>
</li>
<li><p>if no matching heap tuple is found from the current child partition, then there is no conflict</p>
</li>
<li><p>if a matching heap tuple is found from the current child partition, additional checks will be done in below:</p>
</li>
<li><p>if the found tuple is not yet committed, (for example, another backend is still working on this tuple and has not yet committed), the process will wait here until the other process commits or aborts.</p>
</li>
<li><p>when the other process commits or aborts, the process will re-fetch the same tuple again. </p>
</li>
<li><p>if the other backend aborts, the duplicate tuple should fail to be fetched, and therefore no conflicts</p>
</li>
<li><p>if the other backend commits, the duplicate tuple can still be fetched, and therefore a potential conflict.</p>
</li>
<li><p>before raising error, PG will do one more checking, which is to fetch the visibility status of the heap tuple that PG is currently inserting. This is to cover a case where another backend is currently doing CREATE UNIQUE INDEX CONCURRENTLY while the current backend is trying to insert or update the data. </p>
</li>
<li><p>check if the current tuple to be inserted can be fetched from the heap relation</p>
</li>
<li><p>if yes, then the current tuple is still visible and there is definitely a conflict</p>
</li>
<li><p>if no, then the current tuple has become invisible and is not considered a conflict</p>
</li>
<li><p>continue with index tree creation if no conflict is found</p>
</li>
</ol>
<p>This logic above is mostly located in <code>_bt_doinsert()</code> and <code>_bt_check_unique()</code> functions within <code>src/backend/access/nbtree/nbtinsert.c</code>.</p>
<h3 id="4-0-ATTACH-Uniqueness-Guarantee"><a href="#4-0-ATTACH-Uniqueness-Guarantee" class="headerlink" title="4.0 ATTACH Uniqueness Guarantee"></a>4.0 ATTACH Uniqueness Guarantee</h3><p>The table to be attached can either have unique (or not unique) index already defined or have no index at all. There are 2 potential cases during ATTACH:</p>
<ul>
<li><p>Attaching a table with no index to a partition table, PG will automatically create a new index for the attached table following similar index parameters as the original partition table. But currently. This index creation follows the same procedures defined in <code>2.0</code></p>
</li>
<li><p>Attaching a table with a unique index defined using the same index key as partition table’s global unique index, PG will not create a new index for the attached table, and will simply attach the table. </p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/08/05/How-to-Set-Up-NFS-and-Run-PG-on-it/" class="image is-7by1">
            <img class="thumbnail" src="/images/nfs.png" alt="How to Set Up NFS and Run PG on it">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-08-05T18:07:43.000Z">2022-08-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 832 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/08/05/How-to-Set-Up-NFS-and-Run-PG-on-it/">How to Set Up NFS and Run PG on it</a>
            
        </h1>
        <div class="content">
            <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Network File System (NFS) is a distributed file system protocol that allows a user on a client node to access files residing on a server node over network much like local storage is accessed. Today in this blog, I will share how to set up both NFSv4 server and client on CentOS7 and run PG on it. </p>
<h3 id="NFS-Server"><a href="#NFS-Server" class="headerlink" title="NFS Server"></a>NFS Server</h3><p>First, install the NFS server components by</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install nfs-utils</span><br></pre></td></tr></table></figure>

<p>This will install <code>nfs</code> process on the server machine in which we can go ahead to enable and start the NFS server</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl enable nfs</span><br><span class="line">systemctl start nfs</span><br></pre></td></tr></table></figure>

<p>Create a directory that will be mounted by NFS clients</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;home&#x2F;myserveruser&#x2F;sharedir</span><br></pre></td></tr></table></figure>

<p>In /etc/exports, add a new record like below</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;home&#x2F;myuser&#x2F;sharedir	X.X.X.X(rw,sync,no_subtree_check,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>This line is allowing a client having IP address of X.X.X.X to mount the directory at <code>/home/myserveruser/sharedir</code> and can do read and write as specified by <code>rw</code> option. For all possible options, refer to the blog <a href="https://www.thegeekdiary.com/understanding-the-etc-exports-file/">here</a> for definition of each options used. This directory will be used to initialized PostgreSQL database cluster by a NFS client over the network.</p>
<p>If more than one client/host will mount the same directory, you will need to include them in <code>/etc/exports</code> as well.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;home&#x2F;myuser&#x2F;sharedir	X.X.X.X(rw,sync,no_subtree_check,no_root_squash)</span><br><span class="line">&#x2F;home&#x2F;myuser&#x2F;sharedir	A.A.A.A(rw,sync,no_subtree_check,no_root_squash)</span><br><span class="line">&#x2F;home&#x2F;myuser&#x2F;sharedir	B.B.B.B(rw,sync,no_subtree_check,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>Then, we are ready to restart the NFS service to take account the new changes in <code>/etc/exports</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart nfs</span><br></pre></td></tr></table></figure>

<p>Record the userid and groupid of the user associated with the directory to be exported to client. For example, userid = 1009, groupid = 1009</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id myuser</span><br></pre></td></tr></table></figure>

<p>You may also want to ensure that the firewall on centos7 is either disabled or set to allow the NFS traffic to passthrough. You can check the firewall status and add new port to be allowed with the following commands:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo firewall-cmd --zone&#x3D;public --list-all</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;public --add-port&#x3D;2049&#x2F;tcp</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;public --add-port&#x3D;2049&#x2F;udp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h3 id="NFS-Client"><a href="#NFS-Client" class="headerlink" title="NFS Client"></a>NFS Client</h3><p>First, install the NFS client components by</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install nfs-utils</span><br></pre></td></tr></table></figure>

<p>Create a directory on the client side that will be used as the mount point to the NFS server</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;home&#x2F;myserveruser&#x2F;sharedir</span><br></pre></td></tr></table></figure>
<p>Since PostgreSQL cannot be run as <code>root</code> user, we need a way to mount the remote NFS without root privileges. To do that, we need to add one more entry in <code>/etc/fstab</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Y.Y.Y.Y:&#x2F;home&#x2F;myserveruser&#x2F;sharedir		&#x2F;home&#x2F;myclientuser&#x2F;mountpoint	nfs 	rw,noauto,user 0 0</span><br></pre></td></tr></table></figure>

<p>where Y.Y.Y.Y is the IP address of the NFS server that client will connect to, <code>nfs</code> is the type of file system we will mount as, <code>rw</code> means read and write, <code>noauto</code> means the mount point will not be mounted automatically at system startup and <code>user</code> means this mount point can be mounted by a non-root user.</p>
<p>With this new line added to <code>/etc/fstab</code>, you could try mounting it using <code>mount -a</code> command or simply do a <code>reboot</code></p>
<p>Now, we need to match the <code>userid</code> and <code>groupid</code> of <code>myserveruser</code> on the NFS server side and <code>myclientuser</code> on the NFS side. The user names do not have to be equal, but the userid and groupid must be equal to have the correct <code>permission</code> to access the mounted directory,</p>
<p>To set the userid and groupid of the <code>myclientuser</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">usermod -u 1009 myclientuser</span><br><span class="line">groupmod -u 1009 myclientuser</span><br></pre></td></tr></table></figure>

<p>where <code>1009</code> is recorded on the NFS server side by the <code>id</code> command.</p>
<p>Please note that the above commands will change the property of the specified user and that will also cause the tool to iteratively change all the files under <code>/home/myclientuser</code> to be the same property given that it is owned by the specified user. This process may take a long time to complete. if you have a huge amount of data there, I would recommend creating a new user instead of changing the userid and groupid. Please note that files outside of specified user’s <code>/home</code> directory will not be changed the properly, which means current user can no longer access them once userid and groupid have been changed.</p>
<p>With all the setup in place, we are now ready to mount NFS:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mount &#x2F;home&#x2F;clientuser&#x2F;mountpoint;</span><br></pre></td></tr></table></figure>

<p>and the folder <code>mountpoint</code> on NFS client side will now reflect to <code>sharedir</code> folder on the NFS server</p>
<p>Finally, we can initialize a new database cluster on the mountpoint on the NFS client side</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ initdb -D &#x2F;home&#x2F;clientuser&#x2F;mountpoint</span><br></pre></td></tr></table></figure>

<p>and the initial database files should be physically stored on the NFS server side instead of NFS client. This may take longer than usual because the file I/Os are now done over the network via NFS.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/07/08/Maintain-a-custom-PG-to-PG-Connection-With-libpq-s-COPY-protocol/" class="image is-7by1">
            <img class="thumbnail" src="/images/copy.png" alt="Maintain a custom PG to PG Connection With libpq&#39;s COPY protocol">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-07-08T16:45:40.000Z">2022-07-08</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 922 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/07/08/Maintain-a-custom-PG-to-PG-Connection-With-libpq-s-COPY-protocol/">Maintain a custom PG to PG Connection With libpq&#39;s COPY protocol</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>Recently in my development work, a custom connection is required to be maintained between a PG backend on primary and another PG backends on standby nodes to communicate custom data in addition to the existing walsender/walreceiver connection that streams WAL data. Of course, I could just create a new standalone backend and maintain a socket connection myself to communicate custom data. Technically, It could work, but it also created several problems. the persistence, user security, data encryption of this custom connection all need to be handled as well. So, why not just use libpq to handle all of these for us? Today, in this blog, I will share my experience with using libpq COPY protocol to maintain a custom connection for custom data based on PG14.</p>
<h3 id="2-Create-new-routines-in-libpqwalreceiver-c"><a href="#2-Create-new-routines-in-libpqwalreceiver-c" class="headerlink" title="2. Create new routines in libpqwalreceiver.c"></a>2. Create new routines in libpqwalreceiver.c</h3><p>This file is located in <code>src/backend/replication/libpqwalreceiver</code> and is compiled as a shared library (.so) that contains routines related to libpq library that allows a PG backend to use libpq without having it compiled in the backend code. When a PG backend process needs to use libpq, it needs to load the shared library first using <code>load_file()</code> call. </p>
<p>My requirement is simple, the new routines I needed are <code>connect</code>, <code>send</code>, <code>recv</code>, similar to normal socket interactions. I do not have a <code>close</code> function defined here, because I would like the connection to be persisted as long as the primary and standby are running. When one of them exits, the connection will be automatically terminated once it has detected the peer has disconnected. </p>
<h3 id="3-The-Connect-Routine"><a href="#3-The-Connect-Routine" class="headerlink" title="3. The Connect Routine"></a>3. The Connect Routine</h3><p>Unlike the <code>libpqrcv_connect</code> routine for replication, my case is much simpler. I just need my standby node to connect to the primary node, so I can simply reuse standby’s <code>primary_conninfo</code> configuration parameter to connect. This will trigger the primary node to fork a new backend process to serve this connection. A code snipper could look like this:</p>
<p><img src="/images/connect.jpg" alt="connect"></p>
<p>I also set my libpq socket connection to use blocking socket and set <code>asyncStatus</code> to be <code>PGASYNC_COPY_BOTH</code> to indicate that I will be doing a bidirectional data communication </p>
<h3 id="4-The-Send-Routine"><a href="#4-The-Send-Routine" class="headerlink" title="4. The Send Routine"></a>4. The Send Routine</h3><p>My send routine is exactly the same to the <code>libpqrcv_send</code> routine for replication. Both uses <code>PQputCopyData</code> to send streams of data out to the primary. Renamed it for consistency. Snippet below:</p>
<p><img src="/images/send.jpg" alt="send"></p>
<h3 id="5-The-Recv-Routine"><a href="#5-The-Recv-Routine" class="headerlink" title="5. The Recv Routine"></a>5. The Recv Routine</h3><p>Also, very similar to <code>libpqrcv_recv</code> routine for replication, it shares almost exactly the same code. Except that for my requirement, the connection needs to be a <code>synchronous</code> connection. This means that my standby will block while waiting for primary to respond. In order to make recv synchronous, I had to pass a <code>0</code> to the third argument of <code>PQgetCopyData</code>. So, if you are okay with <code>asynchronous</code> connection, this routine could look exactly the same as <code>libpqrcv_recv</code> as well.</p>
<p><img src="/images/recv.jpg" alt="recv"></p>
<h3 id="6-Having-Standby-to-Send-Out-Some-Custom-Data"><a href="#6-Having-Standby-to-Send-Out-Some-Custom-Data" class="headerlink" title="6. Having Standby to Send Out Some Custom Data"></a>6. Having Standby to Send Out Some Custom Data</h3><p>Now that we have the libpq wrapper routines made for our own purpose, we can then have the standby sends some custom data to the primary and waits for a response. Note that I am sending a letter ‘N’ followed by 3 example custom data, 100, 200, 300. Libpq COPY uses the letter <code>d</code> to indicate a COPY command, and what we are doing here is to <code>wrap</code> our own commands within the <code>d</code> command</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">StringInfoData buf_blk_request;</span><br><span class="line">WalReceiverConn *wrconn;</span><br><span class="line">int len;</span><br><span class="line"></span><br><span class="line">load_file(&quot;libpqwalreceiver&quot;, false);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wrconn &#x3D; netbuf_connect(&quot;dbname&#x3D;postgres  host&#x3D;127.0.0.1 port&#x3D;5550&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">initStringInfo(&amp;buf_blk_request);</span><br><span class="line">pq_sendbyte(&amp;buf_blk_request, &#39;N&#39;);</span><br><span class="line">pq_sendint32(&amp;buf_blk_request, 100);</span><br><span class="line">pq_sendint32(&amp;buf_blk_request, 200);</span><br><span class="line">pq_sendint32(&amp;buf_blk_request, 300);</span><br><span class="line">pq_flush();</span><br><span class="line"></span><br><span class="line">&#x2F;* Send it *&#x2F;</span><br><span class="line">netbuf_send(wrconn, buf_blk_request.data, buf_blk_request.len);</span><br><span class="line"></span><br><span class="line">&#x2F;* Read the data *&#x2F;</span><br><span class="line">len &#x3D; netbuf_recv(wrconn, &amp;tmp, &amp;fd);</span><br><span class="line">if (len &gt; 0)</span><br><span class="line">&#123;</span><br><span class="line">	&#x2F;*</span><br><span class="line">	 * Something was received from primary</span><br><span class="line">	 *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-Having-Primary-to-Receive-the-Custom-Data"><a href="#7-Having-Primary-to-Receive-the-Custom-Data" class="headerlink" title="7. Having Primary to Receive the Custom Data"></a>7. Having Primary to Receive the Custom Data</h3><p>When we send something using the methods above, the primary’s postmaster’s main loop will receive the data and decide what to do. Because we are using COPY protocol, the first character is <code>d</code>, in which <code>src/backend/tcop/postgres.c</code> already has a handler for that. So we will need to add additional code under the <code>d</code> handler in <code>postgres.c</code> to receive and process the data sent by standby and provide a response if needed.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case &#39;d&#39;:			&#x2F;* copy data *&#x2F;</span><br><span class="line">	elog(DEBUG2, &quot;copy data request received&quot;);</span><br><span class="line">	int op;</span><br><span class="line"></span><br><span class="line">	op &#x3D; pq_getmsgbyte(&amp;input_message);</span><br><span class="line">	if (op &#x3D;&#x3D; &#39;N&#39;)</span><br><span class="line">	&#123;</span><br><span class="line">		StringInfoData buf_blk_reply;</span><br><span class="line">		int data1, data2, data3;</span><br><span class="line"></span><br><span class="line">		&#x2F;* receive custom data here *&#x2F;</span><br><span class="line">		data1 &#x3D; pq_getmsgint(&amp;input_message, 4);</span><br><span class="line">		data2 &#x3D; pq_getmsgint(&amp;input_message, 4);</span><br><span class="line">		data3 &#x3D; pq_getmsgint(&amp;input_message, 4);</span><br><span class="line">		pq_getmsgend(&amp;input_message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#x2F;* send another custom data back to standby here *&#x2F;</span><br><span class="line">		pq_beginmessage(&amp;buf_blk_reply, &#39;d&#39;);</span><br><span class="line">		pq_sendint32(&amp;buf_blk_request, 400);</span><br><span class="line">		pq_sendint32(&amp;buf_blk_request, 500);</span><br><span class="line">		pq_sendint32(&amp;buf_blk_request, 600);</span><br><span class="line">		pq_endmessage(&amp;buf_blk_reply);</span><br><span class="line">		pq_flush();</span><br><span class="line">	&#125;</span><br><span class="line">	break;</span><br></pre></td></tr></table></figure>

<h3 id="8-Summary"><a href="#8-Summary" class="headerlink" title="8. Summary"></a>8. Summary</h3><p>Based on libpq COPY, I have created a separate communication channel between a primary and standby node that can be used to communicate custom data similar to how you would normally handle a regular socket. All this is based on the COPY protocl that libpq already supports and within that protocol, we wrap our own data. In the above examples, when standby sends 100, 200, 300 to the primary, it is able to receive it and respond 400, 500, 600. This simple example can be expanded to support other things that you may need in your development. This way of using COPY for my own purpose may not be the cleanest way, but it is what works for me.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/06/10/Understand-PG-s-MVCC-Visibility-Check-Rules/" class="image is-7by1">
            <img class="thumbnail" src="/images/visicheck.png" alt="Understand PG&#39;s MVCC Visibility Check Rules">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-06-10T18:13:40.000Z">2022-06-10</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 973 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/06/10/Understand-PG-s-MVCC-Visibility-Check-Rules/">Understand PG&#39;s MVCC Visibility Check Rules</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>PostgreSQL’s MultiVersion Concurrency Control (MVCC) is an “advanced technique for improving database performance in a multi-user environment” according  to Vadim Mikheev. This technique requires multiple “versions” of the same data tuple exist in the system governed by snapshots taken during different time periods. In other words, under such technique, it is PG’s responsibility to figure out how many tuples are <code>visible</code> to the user and how many are not, according to multiple parameters such as snapshots taken, current transaction ID…etc. This is also known as <code>visibility check</code> rules in PG and today in this blog, I will talk about the basic principles of visibility check so you get an idea how PG performs this task internally and I hope it would be helpful in your development work.</p>
<h3 id="2-Parameters-Involved"><a href="#2-Parameters-Involved" class="headerlink" title="2. Parameters Involved?"></a>2. Parameters Involved?</h3><ul>
<li>The tuple itself, which contains:<ul>
<li>xmin (the transaction ID that inserts this tuple)</li>
<li>xmax (the transaction ID that deletes this tuple if &gt; 0, otherwise it’s not deleted)</li>
<li>cid (command ID)</li>
<li>hintbit </li>
</ul>
</li>
<li>Global top transaction ID if available </li>
<li>current snapshot, which also contains xmin, xmax and cid</li>
<li>Commit Log Data (CLOG)</li>
</ul>
<h3 id="3-The-Process"><a href="#3-The-Process" class="headerlink" title="3. The Process"></a>3. The Process</h3><h4 id="3-1-Check-the-Hintbit"><a href="#3-1-Check-the-Hintbit" class="headerlink" title="3.1 Check the Hintbit"></a>3.1 Check the Hintbit</h4><p>The visibility process starts by checking the hintbit. If hintbit has a state of <code>COMMITTED</code>, then we can skip most of the other visibility checking rules for better efficiency. With the tuple committed, PG then take this tuple’s xmin value to check with the current snapshot to ensure this tuple is not currently <code>in progress</code>. (See 3.3 below for formula to determine <code>in progress</code>). This check is required because there is a chance that this tuple, though committed, is still being updated by other backend processes at this very moment. If the tuple is not currently <code>in progress</code> by other backends, it will finally check its <code>xmax</code> value to ensure that it is invalid. Invalid means it has not been deleted. When all of the above are true, this tuple is considered visible.</p>
<p>If hintbit indicates <code>ABORTED</code>, then this tuple is considered invisible to user. If hintbit has no value, then PG should continue with the rest of visibility check rules.</p>
<h4 id="3-2-Check-If-Tuple’s-xmin-Equal-to-Global-Top-Transaction-ID"><a href="#3-2-Check-If-Tuple’s-xmin-Equal-to-Global-Top-Transaction-ID" class="headerlink" title="3.2 Check If Tuple’s xmin Equal to Global Top Transaction ID"></a>3.2 Check If Tuple’s xmin Equal to Global Top Transaction ID</h4><p>The next check involves taking tuple’s xmin and compare with global top transaction ID to see if they are equal. This global top transaction ID will only be set when user starts the transaction manually with <code>begin</code> clause. If user does not starts the transaction this way (no <code>begin</code> clause is issued), then this global top transaction ID will not be set and therefore this checking will be skipped. </p>
<p>If tuple xmin equals global top transaction ID, this means the tuple is currently <code>in progress</code> by the current backend, not others. This is where the command ID (cid) will be used to determine the visibility. Within a transaction block, each command issued has an associated command ID to indicate what command comes first and what comes later. For example, if a SELECT comes after an UPDATE, within a transaction, then the SELECT must see the new tuple updated by the previous UPDATE clause and cid plays a part in this determination. This behavior is also governed by the <code>isolation level</code> which is unfortunately out of scope of this blog. The default isolation level is <code>READ COMMITTED</code>, which makes the SELECT sees the data changed by previous UPDATE; but if the isolation is set to <code>REPEATABLE READ</code> then the SELECT will not see the data changed by previous UPDATE. Please keep this in mind.</p>
<p>If tuple’s xmin does not equal to global top transaction ID, then PG should continue with the rest of visibility</p>
<h4 id="3-3-Check-the-Current-Snapshot"><a href="#3-3-Check-the-Current-Snapshot" class="headerlink" title="3.3 Check the Current Snapshot"></a>3.3 Check the Current Snapshot</h4><p>The next check involves the PG to check if this tuple is currently <code>in progress</code> by other backend processes. This is done by comparing the tuple’s xmin value against current snapshot’s xmin and xmax values according to this formula.</p>
<ul>
<li>tuple xmin &lt; snapshot xmin = not in progress</li>
<li>tuple xmin &gt;= snapshot xmax = in progress</li>
</ul>
<p>If this tuple is considered <code>in progress</code> by the snapshot, then this tuple must not be visible to the current user because other backends are still working on it. If this tuple is NOT considered <code>in progress</code>, then PG should continue with the rest of visibility check rules.</p>
<h4 id="3-4-Check-the-Commit-Log-CLOG"><a href="#3-4-Check-the-Commit-Log-CLOG" class="headerlink" title="3.4 Check the Commit Log (CLOG)"></a>3.4 Check the Commit Log (CLOG)</h4><p>This next check involves the PG to take tuple’s xmin to check against the CLOG to see if this tuple has been committed or aborted. CLOG is like an array of transaction IDs and each array element stores a commit status. PG has a formula to convert a transaction ID into a CLOG block plus an offset to precisely access the right CLOG element. This CLOG data structure is regularly flushed to disk with checkpoint process and it is located in these 3 directories: <code>pg_xact</code>, <code>pg_multixact</code> and <code>pg_subtrans</code>. </p>
<p>If CLOG says the given tuple is committed, then PG will continue to check the tuple’s <code>xmax</code> value to ensure that it is invalid. Invalid means it has not been deleted and therefore it is visible to user. At the same time, PG will also update the hintbit value of this tuple to <code>COMMITTED</code> such that in the next visibility checking, PG will not access CLOG again, which is rather expensive. </p>
<p>If CLOG says the given tuple is aborted or invalid, then this tuple is not visible to the current user. At the same time, it will also update the hintbit value of this tuple to <code>INVALID</code> </p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>The above processes are the very basic visibility rules within PG according to my understanding. Of course there are other complex checking not mentioned here, such as the involvement of sub transactions and multi transactions, but they do follow somewhat similar pattern to what’s mentioned today. I hope this blog would be helpful for you.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/05/06/Ensure-Atomic-Commit-with-2-Phase-Commit-in-FDW-Distributed-Setup/" class="image is-7by1">
            <img class="thumbnail" src="/images/2pc2.png" alt="Atomic Commit with 2 Phase Commit in FDW Distributed Setup">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-05-06T18:51:12.000Z">2022-05-06</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 849 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/05/06/Ensure-Atomic-Commit-with-2-Phase-Commit-in-FDW-Distributed-Setup/">Atomic Commit with 2 Phase Commit in FDW Distributed Setup</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>PostgreSQL’s 2 phase commit (2PC) feature allows a database to store the details of a transaction on disk without committing it. This is done by issuing <code>PREPARE TRANSACTION [name]</code> command at the end of a transaction block. When the user is ready to commit, he/she can issue <code>COMMIT PREPARED [name]</code> where [name] should match the [name] in PREPARE TRANSACTION command. Because the transaction details are stored on disk with 2PC, the server is able to commit this transaction at a later time even if it crashes or out of service for some time. In a single database instance, the use of 2PC is not critical; the plain ‘commit’ can perform the job equally as well. However, in a larger setup, the data may be distributed on 2 or more database instances (for example, via Foreign Data Wrapper (FDW)), the use of 2PC is absolutely critical here to keep every database instance in sync. </p>
<h3 id="2-Atomic-Commit-Problem-with-Foreign-Data-Wrapper-FDW"><a href="#2-Atomic-Commit-Problem-with-Foreign-Data-Wrapper-FDW" class="headerlink" title="2. Atomic Commit Problem with Foreign Data Wrapper (FDW)"></a>2. Atomic Commit Problem with Foreign Data Wrapper (FDW)</h3><p>Current postgres_fdw does not support the use of 2PC to commit foreign server. When a <code>commit</code> command is sent to the main server, it will send the same <code>commit</code> command to all of the foreign servers before processing the <code>commit</code> for itself. If one of the foreign node fails the <code>commit</code>, the main server will go through a <code>abort</code> process and will not commit itself due to the failure. However, some of the foreign nodes could already been successfully committed, resulting in a partially committed transaction.</p>
<p>Consider this diagram:</p>
<p><img src="/images/2pc-illustrate.drawio.png" alt=""></p>
<p>where the CN node fails the commit to DN3 and goes through a abort process, but at the same time, DN1 and DN2 have already been committed successfully and can no longer be rollbacked. This scenario creates a partial commit that may not be desirable.</p>
<h3 id="3-FDW-with-2PC-Capability"><a href="#3-FDW-with-2PC-Capability" class="headerlink" title="3. FDW with 2PC Capability"></a>3. FDW with 2PC Capability</h3><p>If we were to add a 2PC functionality to current postgres_fdw, instead of sending the same <code>commit</code> to all foreign servers, we let the main server to send <code>PREPARE TRANSACTION</code> instead. The main server should proceed to send COMMIT PREPARE to all foreign servers Only when all of the foreign servers have successfully completed the PREPARE TRANSACTION. If one of them fails at the PREPARE stage, the main server is still able to ROLLBACK those foreign server who have successfully prepared.</p>
<p>Consider this diagram:</p>
<p><img src="/images/2pc-illustrate.drawio2.png" alt=""></p>
<p>where the CN node fails the PREPARE TRANSACTION to DN3 and sends <code>ROLLBACK PREPARED</code> to DN1 and DN2 before going to the abort process. With the 2PC method, there will not be any partial commits.</p>
<h3 id="3-Handling-COMMIT-PREPARED-Failure"><a href="#3-Handling-COMMIT-PREPARED-Failure" class="headerlink" title="3. Handling COMMIT PREPARED Failure?"></a>3. Handling COMMIT PREPARED Failure?</h3><p>If a foreign server fails at the PREPARE stage, it is not too late to rollback the rest of foreign servers that have succeeded the PREPARE, so the main server can still send ROLLBACK PREPARED to the foreign servers. However, if a foreign server fails at the COMMIT PREPARE stage, the other foreign servers who have succeeded it can no longer be rollbacked, potentially causing a partial commit as well.</p>
<p>In our implementation, we still allow the main server to continue with the commit even though a foreign server fails COMMIT PREPARED. In addition, we give user a warning about one of the foreign server may not have committed successfully, which leads to a potential partial commit. The foreign server with a failed COMMIT PREPARE will now have something called a “orphaned prepared transaction” that has yet to be committed. </p>
<p>Consider this diagram:</p>
<p><img src="/images/2pc-illustrate.drawio3.png" alt=""></p>
<p>where DN3 fails a COMMIT PREPARED command and the CN node continues the commit with warning. </p>
<h3 id="4-Handling-Orphaned-Prepared-Transaction"><a href="#4-Handling-Orphaned-Prepared-Transaction" class="headerlink" title="4. Handling Orphaned Prepared Transaction"></a>4. Handling Orphaned Prepared Transaction</h3><p>Following the above example, if we perform a SELECT query, we will see that DN3 does not have an updated value while DN1 and DN2 have been updated. Also, DN3 still have the transaction prepared and stored in its disk. What’s left to do is to have somebody to login to DN3 and manually run a COMMIT PREPARED command. If that is done successfully, there will no longer be a partial commit.</p>
<p>The way we handle this is to make a orphaned prepared transaction detector at each foreign server and we introduce an intermediate and external global transaction manager (GTM) node that records all the FDW operations. Again, following the above example, when DN3 detects a orphaned prepare transaction, it will make a connection to the GTM node and check if this prepared transaction comes from a CN node. If it is, then we simply let DN3 do a self-commit of the prepared transaction automatically, without any human intervention. If GTM does not have a record, then this orphaned prepared transaction must be created manually by another DN3 user and it should not do anything to it except to just give a warning in the log file.</p>
<p>This is the general concept how we handle atomic commit and orphaned prepared transactions. There may be better and more complex solutions out there but for us, having an intermediate GTM node to coordinate all the operations between CN and DN nodes seems to be the simplest.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/03/18/Distributed-Database-With-PostgreSQL-Atomic-Commit-Problems/" class="image is-7by1">
            <img class="thumbnail" src="/images/2pc.png" alt="Distributed Database With PostgreSQL - Atomic Commit Problems">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-03-18T20:26:14.000Z">2022-03-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 1063 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/03/18/Distributed-Database-With-PostgreSQL-Atomic-Commit-Problems/">Distributed Database With PostgreSQL - Atomic Commit Problems</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>If you are into distributed database research, especially one that is setup using Foreign Data Wrapper (FDW) + partitioned foreign tables, you probably have heard that there are many potential issues associated with this setup. Atomic commit, atomic visibility and global deadlock detection are one of the most popular issues that one can encounter in a distributed database environment. </p>
<p>There has been a lot of discussion on the PostgreSQL community on atomic commit and potential ways to solve this problem, and also discuss how this issue introduces an atomic visibility issue. </p>
<p>I recently had a chance to scan through several of the community discussion on atomic commit and would like to share what I have learned in this blog.</p>
<h3 id="2-The-problem"><a href="#2-The-problem" class="headerlink" title="2. The problem"></a>2. The problem</h3><p>In a distributed environment, if a query involves modification to multiple foreign tables (or shards), current PostgreSQL cannot guarantee  either all of them commit or all of them rollback. This means that, if one of them fails to commit for some reason but the rest have succeeded, we will see inconsistent results. The desired behavior would be that if one of the foreign tables fails to commit, PostgreSQL should be able to roll back the ones that have been committed successfully. </p>
<p>However, with the current postgres_fdw and the transaction manager, it is currently not possible to “uncommit” a foreign transaction that has been committed. This is why most of the discussions generally regard PG’s “2 Phase Commit” as the basic building block to achieve atomic commit.</p>
<h3 id="2-2-Phase-Commit-2PC"><a href="#2-2-Phase-Commit-2PC" class="headerlink" title="2. 2 Phase Commit (2PC)"></a>2. 2 Phase Commit (2PC)</h3><p>2PC basically splits a regular commit action into 2 stages, a PREPARE TRANSACTION and a COMMIT PREPARED (or ROLLBACK PREPARED) stage. Doing this allows PG to uncommit an in-progress commit in case it finds a condition that all of the foreign transactions need to be aborted.</p>
<p>For example, 1 Coordinator Node (CN) sends a UPDATE query to 3 Data Nodes (DNs) and would like to commit</p>
<ul>
<li>CN sends a PREPARE TRANSACTION to each DN1 and waits for response </li>
<li>CN sends a PREPARE TRANSACTION to each DN2 and waits for response </li>
<li>CN sends a PREPARE TRANSACTION to each DN3 and waits for response </li>
</ul>
<p>If any of these PREPARE TRANSACTION (say DN3) fails to deliver or its response contains error, CN still has a chance to ROLLBACK transactions on DN1 and DN2 and DEALLOCATE the existing prepared transaction. After that, the CN will abort the local transaction and finish the transaction with error and nothing gets changed here.</p>
<p>Only if all 3 DNs have confirmed the PREPARE TRANSACTION success, CN can then proceed to commit the local transaction, if local succeeds, continue to send COMMIT PREPARED to each DN, or send ROLLBACK PREPARED if local fails</p>
<ul>
<li>CN sends a COMMIT/ROLLBACK PREPARED to each DN1 and waits for response </li>
<li>CN sends a COMMIT/ROLLBACK PREPARED to each DN2 and waits for response </li>
<li>CN sends a COMMIT/ROLLBACK PREPARED to each DN3 and waits for response </li>
</ul>
<p>If any of these fails to COMMIT PREPARED at this point, say (DN3), CN is not able to uncommit DN1 and DN2 that have been 2-phase committed, so at this point, CN can only retry indefinitely to deliver COMMIT PREPARED to DN3 to ensure atomicity. If DN3 is unreachable, CN will keep on trying forever without closing the transaction and leaving the client waiting. </p>
<p>If client choose to cancel the transaction by hitting ctrl-c, then the transaction will close with a warning message that DN3 has not confirmed a COMMIT PREPARED message and data may be inconsistent. DN3 at this point may have an orphaned prepared transaction that needs to be handled. </p>
<h3 id="3-Orphaned-Prepared-Transaction"><a href="#3-Orphaned-Prepared-Transaction" class="headerlink" title="3. Orphaned Prepared Transaction"></a>3. Orphaned Prepared Transaction</h3><p>In the previous example, an orphaned prepared transaction can happen if CN prepares a foreign transaction but never has a chance to commit it (possibly due to network). In this case, the DN node can very easily detect an orphaned prepared transaction based on the time the prepared transaction has been created. Unfortunately, without a centralized Global Transaction Manager (GTM), DN node is not able to decide if this orphaned prepared transaction should be committed or discarded. Therefore, most of the solutions on the community only support the detection of orphaned prepared transaction without any handling.</p>
<h3 id="4-How-Atomic-Visibility-Appeared"><a href="#4-How-Atomic-Visibility-Appeared" class="headerlink" title="4. How Atomic Visibility Appeared?"></a>4. How Atomic Visibility Appeared?</h3><p>Using 2PC allows CN node to rollback a commit during the PREPARE stage but cannot allow rollback during the commit prepared stage, so it can only retry forever or exit with a warning. The visibility issue can happen in a case where DN1 and DN2 have already comitted the prepared transactions while DN3 has not yet committed. At this point, if a client does a SELECT statement across DN1, DN2 and DN3, it will see that DN3 still does not have the right data but DN1 and DN2 have. This is not atomic at all.</p>
<p>To solve this, several people proposed a snapshot that can be shared globally across all the DN and CN nodes. The standard PG’s snapshot is purely based on transaction ID to determine if a tuple is visible or not, but with multiple different PG servers, each of them have their own transaction ID range and could all be very different, so sharing a snapshot based on transaction ID is impossible. </p>
<p>This is why a Commit Sequence Number (CSN) snapshot is being proposed in the discussion, which is based on time, and could be made the same in all of the CN and DN nodes and act as a reference point to determine if a tuple belongs to the past or future. The problem is then shifted to how to ensure all of the CN and DN nodes have consistently the same time? Even the best clock chipsets are subject to time skewing and will slowly go out of sync. The concept of Clock-SI is then added to the discussion, which is designed to handle such a clock skew. This makes the discussion somewhat more complicated and out of scope. </p>
<p>But for me, this may not be worth the effort to completely solve the atomic visibility issue with all these complicated stuff. </p>
<h3 id="5-reference-to-some-of-the-discussions"><a href="#5-reference-to-some-of-the-discussions" class="headerlink" title="5. reference to some of the discussions"></a>5. reference to some of the discussions</h3><p><a href="https://commitfest.postgresql.org/26/1574/">Transactions involving multiple servers</a><br><a href="https://www.postgresql.org/message-id/flat/CA%2BCSw_tEpJ%3Dmd1zgxPkjH6CWDnTDft4gBi%3D%2BP9SnoC%2BWy3pKdA%40mail.gmail.com">Proosal for CSN based snapshot</a><br><a href="https://www.postgresql.org/message-id/flat/21BC916B-80A1-43BF-8650-3363CCDAE09C%40postgrespro.ru">Global snapshot</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2022/02/18/The-significance-of-LSN-in-PostgreSQL-System/" class="image is-7by1">
            <img class="thumbnail" src="/images/lsn.png" alt="The significance of LSN in PostgreSQL System">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-02-18T19:41:06.000Z">2022-02-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 541 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/02/18/The-significance-of-LSN-in-PostgreSQL-System/">The significance of LSN in PostgreSQL System</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>Last year I wrote a blog about PostgreSQL’s timeline concept, which is essential for executing Point In Time Recovery (PITR) back to a particular timeline and particular Log Sequence Number (LSN). But we have not talked about the idea of LSN in which everything else is built upon. Today in this blog, I will describe the significance of LSN </p>
<h3 id="2-The-LSN-and-REDO"><a href="#2-The-LSN-and-REDO" class="headerlink" title="2. The LSN and REDO"></a>2. The LSN and REDO</h3><p>We hear the term REDO a lot and it could mean a couple things depending on the context it is used. If used as a <code>REDO point</code>, it indicates the location of the current WAL record since the current or last <code>checkpoint</code> is started. This is the point where the database should commence the recovery. </p>
<p>When REDO is used by itself as a verb, it refers to the action of a standby server, which will read the WAL contents sent from the primary via streaming replication and actually replay the actions. Depending on the database action, different ways to REDO needs to be defined. This is why in heapam.c source code, functions like <code>heap_redo</code> and <code>heap2_redo</code> exist.</p>
<p>LSN stands for Log Sequence Number and it is basically a pointer to a location in the WAL. It is represented as unsigned 64-bit value internally in PG; external to the PG, it is represented as 2 hexadecimal number separated by a slash (/), First number being the segment ID of a particular WAL file and second number being the offset within that segment file. </p>
<p>For example: </p>
<p>1/CF54A048 could also be represented as a single value as 0x01CF54A048, which equals to 7,773,397,064 and this is the integer number used internally in PG to compute or comparae different LSN values.</p>
<p>Based on this value, you could tell the volume of a database, the bigger the LSN, the larger the database.</p>
<h3 id="3-The-pd-lsn-value-in-data-page-header"><a href="#3-The-pd-lsn-value-in-data-page-header" class="headerlink" title="3. The pd_lsn value in data page header"></a>3. The pd_lsn value in data page header</h3><p>I have been researching about the feasibility of having multiple PostgreSQL servers to sharer a single set of data storage. One server being able to read and write, the rest of servers are read-only. On the read-only servers, I introduced a temporary storage space in their respective cluster folder to temporary hold any data blocks that they want to eject from the buffer manager in case the primary server has not yet flushed data to the shared storage space.</p>
<p>During my testing with this approach, I came across an issue where the standbys may face a situation where the same data page but different version could exist in both the shared storage and also their own temporary space. Loading the wrong version of the page may result in incorrect output from user queries. </p>
<p>So, how can we solve this issue? </p>
<p>The pd_lsn parameter inside each buffer page header indicates the “last WAL LSN that has modified this page”. So by simply comparing the pd_lsn values from 2 version of the data page, I could ensure the standby always read the correct one.</p>
<p>The LSN is significant in a sense that almost every WAL recovery functions of PG work around LSN and in my own feasibility studies, LSN also plays an important role in making shared standby’s more intelligent in loading data blocks from multiple sources.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2022-01-18T20:57:59.000Z">2022-01-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 minutes read (About 2576 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2022/01/18/2021-PG-Asia-Conferenece-Delivered-Another-Successful-Online-Conference-Again/">2021 PG Asia Conference Delivered Another Successful Online Conference Again!</a>
            
        </h1>
        <div class="content">
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>On December 14-17, 2021, PostgresConf.CN &amp; PGconf.Asia2021 (referred to as 2021 PG Asia Conference) was held online successfully and once again listed as a global gold standard conference on Postgresql.org! This conference was jointly organized by the China PostgreSQL Association, PostgresConf International Conference Organization,and PGConf.Asia Asian Community </p>
<h2 id="About-the-Conference"><a href="#About-the-Conference" class="headerlink" title="About the Conference"></a>About the Conference</h2><p>Also known as the Asia’s largest open source relational database ecology conference</p>
<p>PostgresConf.CN and PGConf.Asia were hosted together as one conference online for the first time back in 2020. In 2021, both conferences joined forces again to deliver another successful conference that attracted record high numbers of PG enthusiasts from the world! </p>
<p>PostgresConf.CN is an annual conference held by the China PostgreSQL Association for PostgreSQL users and developers. It is also one of the conference series held by PostgresConf Organization. PostgreConf.CN 2019 took place in Beijing, it was very well attended by PostgreSQL users and community members across the globe.</p>
<p>PGCONF.Asia is also an annual PostgreSQL event that took place in Bali Indonesia in 2019, it was a continuation of the PGCONF.Asia event that took place in Tokyo, Japan in 2018. The first PGCONG.Asia conference took place in 2016 in Tokyo, this conference acts as a hub of PostgreSQL related development and technical discussion among PostgreSQL users and developers in the region as well as experts from around the globe.</p>
<p>Learn more about these conferences and the organizers from these resources:</p>
<ul>
<li><a href="https://2021.postgresconf.cn/en">2021.postgresconf.cn</a></li>
<li><a href="https://pgconf.asia/EN/">2021.pgconf.asia</a></li>
<li><a href="https://www.postgresconf.org">PostgresConf</a></li>
</ul>
<h2 id="Sponsors"><a href="#Sponsors" class="headerlink" title="Sponsors"></a>Sponsors</h2><p>This conference was sponsored by:</p>
<p><strong>Platinum</strong>:</p>
<ul>
<li><a href="https://cloud.tencent.com/">Tencent Cloud</a></li>
<li><a href="https://aws.amazon.com/">AWS</a></li>
<li><a href="https://www.highgo.com/">HighGo Database</a></li>
</ul>
<p><strong>Golden</strong>:</p>
<ul>
<li><a href="https://es.inspur.com/">Inspur Commercial Systems</a></li>
<li><a href="https://azure.microsoft.com/">Microsoft Azure</a></li>
</ul>
<p><strong>Silver</strong>:</p>
<ul>
<li><a href="https://www.ibm.com/">IBM</a></li>
<li><a href="https://www.kylinos.cn/">Kylin Software</a></li>
<li><a href="https://equnix.asia/">Equnix</a></li>
</ul>
<h2 id="14-Conference-Channels-over-4-Days"><a href="#14-Conference-Channels-over-4-Days" class="headerlink" title="14 Conference Channels over 4 Days!"></a>14 Conference Channels over 4 Days!</h2><p>This conference was broadcast live with a record-high number of viewers streaming the conference events. It consists of a total of 14 live channels delivering speeches in Mandarin Chinese, English, Korean and Indonesian languages. </p>
<p>the conference gathered 101 technical presentations and more than 100 well-known experts and scholars around the world to provide a grand technical feast for all the participating PG enthusiasts.</p>
<ul>
<li>Guangnam Ni, Fellow of the Chinese Academy of Engineering</li>
<li>Peng Liu, Vice chairman of China Open Source Software Promotion Alliance and researcher of the Chinese Academy of Sciences</li>
<li>Xing Chunxiao, deputy director of the Information System Committee of the China Computer Federation</li>
<li>Bruce Momjian, co-founder of PostgreSQL international community and vice president of EDB</li>
<li>Peter Zaitsev, Founder and CEO of Percona</li>
<li>Ding Zhiming, Director of the Spatiotemporal Data Science Research Center of the Chinese Academy of Sciences</li>
<li>Experts from from HighGo, Alibaba, Tencent, Amazon, Kylin, Inspur, Ping An, Meichuang, SphereEx, Inspur Yunxi database, VMware Greenplum, Huawei, Ali cloud, ZTE…etc</li>
<li>Professors from Peking University, Tsinghua University, Institute of Information Technology, Chinese Academy of Sciences, Shenzhen University, Zhengzhou University, Shandong Normal University, Suzhou University of Science and Technology and other academic and scientific research institutions</li>
<li>And many, many more!</li>
</ul>
<p>With the great support from these PostgreSQL communities, the conference was held with great success, which brought together the Chinese PG power, major Asian PG contributors and many PostgreSQL experts worldwide to build the largest PG ecosystem in Asia.</p>
<h2 id="Conference-Highlights"><a href="#Conference-Highlights" class="headerlink" title="Conference Highlights"></a>Conference Highlights</h2><h3 id="Opening-Speech-by-Fellow-Guangnan-Ni"><a href="#Opening-Speech-by-Fellow-Guangnan-Ni" class="headerlink" title="Opening Speech by Fellow Guangnan Ni"></a>Opening Speech by Fellow Guangnan Ni</h3><p><img src="/images/ni-2021.webp" alt="Guangnan Ni"></p>
<p>Guangnan Ni first expressed his warm congratulations to the holding of the PGConf.Asia 2021 Asia Conference, and greeted sincerely to the representatives of various countries and open source experts participating in the conference. He pointed out that open source is an important trend in the development of today’s world, and open source technology is profoundly changing the global digital economy and information industry pattern. The holding of this PG Asia Conference is of great significance to the development of the open source industry, the promotion of the open source movement and the popularization of open source culture in China, and the strengthening of international exchanges and cooperation.</p>
<h3 id="Bruce-Momjian"><a href="#Bruce-Momjian" class="headerlink" title="Bruce Momjian"></a>Bruce Momjian</h3><p><img src="/images/bruce-2021.webp" alt="Bruce Momjian"></p>
<p>Bruce Momjian, as a core group member of the PG international community, has always been keen on sharing themes in the community. This time Bruce made a sharing based on the status quo of PG, project development challenges, competition challenges, and technical challenges, mainly emphasizing that the development process of the PG version has been adapting. Changes in the environment, continuous breakthroughs and innovations, such as SSD optimization, virtualization, containerization, and functional expansion of cloud environments have been completed in the face of technical challenges. For the future evolution of the PG version, it will continue to optimize and iterate on several aspects such as PG write amplification, TDE encryption, and horizontal scalability.</p>
<h3 id="Peter-Zaitsev"><a href="#Peter-Zaitsev" class="headerlink" title="Peter Zaitsev"></a>Peter Zaitsev</h3><p><img src="/images/peter-2021.webp" alt="Peter Zaitsev"><br>Mr. Peter Zaitsev, CEO of Percona, has been a guest at the PG Asia Conference for the second time. This time Peter brought us a speech of “State of Open Source Databases”, mainly from cloud computing, PG peripheral ecology, DaaS and K8S. This aspect expresses the openness and flexibility of PG, which enables PG and the evolution of the technical architecture to be better integrated, promote mutual development, and meet the needs of different business scenarios. He said that Percona, which has been engaged in open source database services for many years, loves to embrace PG and make innovations based on PG to bring more value to customers.</p>
<h3 id="Chunxiao-Xing"><a href="#Chunxiao-Xing" class="headerlink" title="Chunxiao Xing"></a>Chunxiao Xing</h3><p><img src="/images/xing-2021.webp" alt="Chunxiao Xing"><br>Professor Xing Chunxiao, deputy dean of the Institute of Information Technology of Tsinghua University and deputy director of the Information System Committee of the China Computer Federation, shared with us the most popular topics of “metaverse”, blockchain, and data lake, emphasizing that data management is a popular technology development Only the continuous evolution and iteration of database management software can better provide support for cutting-edge technologies and make our lives more meaningful.</p>
<h3 id="Zhiming-Ding"><a href="#Zhiming-Ding" class="headerlink" title="Zhiming Ding"></a>Zhiming Ding</h3><p><img src="/images/ivorysql-2021.webp" alt="Zhiming Ding"><br>The ivorySQL project is a PG open source derivative project with a broad ecological foundation and Chinese characteristics. Its purpose is to develop community collaboration among Chinese developers and allow engineers to create greater personal and social value.</p>
<p>The session was presented by Professor Ding Zhiming, an early promoter of research practice in the domestic PG field, the new president of the China PG branch, and director of the Center for Space-Time Data Science (STDMS) of the Chinese Academy of Sciences. Their system completely expounds the necessity and realization idea of “PostgreSQL database software + Chinese characteristics”, the positioning, characteristics and operation mode of the ivorySQL project and community. Through the launch event, the project was officially known to the majority of PG practitioners in China.</p>
<p>The launch of IvorySQL attracted many domestic PG enthusiasts, and they have provided suggestions and opinions to make the project better. We feel very thankful for their effort into this new project. In the mean time, please check out the project’s official website at <a href="http://www.ivorysql.org">www.ivorysql.org</a> for the latest developments.</p>
<h3 id="Xiaojun-Zheng"><a href="#Xiaojun-Zheng" class="headerlink" title="Xiaojun Zheng"></a>Xiaojun Zheng</h3><p><img src="/images/zheng-2021.webp" alt="Xiaojun Zheng"><br>Xiaojun Zheng, Chief Scientist of HighGo, presented “Highgo peer-to-peer service cluster database”.</p>
<p>Mr. Zheng first gave a systematic overview of the definition of database cluster, and then explained the concept and implementation of “peer-to-peer service cluster” in a more generalized manner. Finally, Mr. Zheng led everyone to experience Higao’s Peer-to-peer service cluster database environment. Through this practical demonstration, we have brought you a new idea and method for realizing peer-to-peer service clustering. Architects and product managers who pay attention to the PostgreSQL database, I believe they can gain new product inspiration from it.</p>
<h3 id="Jian-Feng"><a href="#Jian-Feng" class="headerlink" title="Jian Feng"></a>Jian Feng</h3><p><img src="/images/jian-2021.webp" alt="Jian Feng"><br>Director Feng first introduced the two major product lines of K1 Power and their respective market opportunities, advantages, and application scenarios. He then demonstrated the business value of K1 Power’s advanced virtualization features to PostgreSQL database in four aspects, and elaborated on running under K1 Power Linux. The best practices of the PostgreSQL database and the uniqueness of the x86 CPU. Finally, Director Feng introduced the PowerFans community on Github <a href="https://github.com/powerfans/">https://github.com/powerfans/</a>. This PowerFan community can be said to be the king of technical feasts. In addition to providing the above best practices, it also provides open-source software binary packages, useful tools and documentation, etc. This PowerFans community provides database enthusiasts with great convenience to use the Power server platform, such as: PostgreSQL under the PowerLinux platform and you no longer need to make RPM packages yourself, Inspur commercial machines are ready for you!</p>
<h3 id="Grant-Zhou-The-Launch-of-IvorySQL-Open-Source-Project"><a href="#Grant-Zhou-The-Launch-of-IvorySQL-Open-Source-Project" class="headerlink" title="Grant Zhou - The Launch of IvorySQL Open Source Project"></a>Grant Zhou - The Launch of IvorySQL Open Source Project</h3><p><img src="/images/ivorysql2-2021.webp" alt="ivorysql"><br>This conference specially invited the well-known domestic database solution supplier, HighGo Database, to jointly organize and launch the HighGo database sub-forum. Jichao Ma, the pre-sales director of HighGo Software, presented “Highgo Database New Features”, and introduced some new features and functions of HighGo Database related to high availability.</p>
<p>Grant Zhou, head of the IvorySQL open source community presented “IvorySQL-an Oracle compatible open source PostgreSQL database”, and introduced an Oracle-compatible open source PostgreSQL database ivorySQL. </p>
<h3 id="KaiGai-Kohei"><a href="#KaiGai-Kohei" class="headerlink" title="KaiGai Kohei"></a>KaiGai Kohei</h3><p><img src="/images/kai-2021.png" alt="KaiGai Kohei"><br>KaiGai Kohei has been a contributor of PostgreSQL and Linux kernel over 15 years. He presented a speech called “GPU revision of PostGIS” that introduces an extension called “PG-Storm” to pull resource from GPU for analytic SQL workloads.</p>
<h3 id="Takeshi-MISHIMA"><a href="#Takeshi-MISHIMA" class="headerlink" title="Takeshi MISHIMA"></a>Takeshi MISHIMA</h3><p><img src="/images/takeshi-2021.png" alt="Takeshi MISHIMA"><br>Takeshi MISHIMA is a Ph.D in engineering principle of SRA OSS, Inc. He presented a speech called “A Middleware to Synchronize Multiple Instances in a PostgreSQL Cluster” that introduced a middle ware called “Pangea” to provide better performance in clustering synchronization by load balancing SELECT queries</p>
<h3 id="Paul-Brebner"><a href="#Paul-Brebner" class="headerlink" title="Paul Brebner"></a>Paul Brebner</h3><p><img src="/images/paul-2021.png" alt="Paul Brebner"><br>Paul Brebneris the Technology Evangelist at Instaclustr. He’s been learning new scalable open source technologies, solving realistic problems, and building applications, and blogging about Apache Cassandra, Apache Kafka and of course PostgreSQL! He presented a speech called “Change Data Capture (CDC) With Kafka Connect and the Debezium PostgreSQL Source Connector” to introduce the “Debezium PostgreSQL Connector”, and explain how it can make the elephant (PostgreSQL) to be as fast as a cheetah (Kafka) such that the system becomes more change-aware and flexible.</p>
<h3 id="Michael-Christofides"><a href="#Michael-Christofides" class="headerlink" title="Michael Christofides"></a>Michael Christofides</h3><p><img src="/images/michael-2021.png" alt="Michael Christofides"><br>Michael Christofides is the Co-founder of pgMustard who presented a speech called “A beginners guide to EXPLAIN ANALYZE” to give a beginner friendly introduction to EXPLAIN vs EXPLAIN ANALYZE.</p>
<h3 id="Bohan-Zhang"><a href="#Bohan-Zhang" class="headerlink" title="Bohan Zhang"></a>Bohan Zhang</h3><p><img src="/images/bohan-2021.png" alt="Bohan Zhang"><br>Bohan Zhang is the co-founder of OtterTune who presented a speech called “Ottertune: automatic database optimization using machine learning” which talks about how the database group of Carnegie Mellon University uses machine learning to automatically tune and improve database systems.</p>
<h3 id="Ibrar-Ahmed"><a href="#Ibrar-Ahmed" class="headerlink" title="Ibrar Ahmed"></a>Ibrar Ahmed</h3><p><img src="/images/ibrar-2021.png" alt="Ibrar Ahmed"><br>Ibrar Ahmed is a Senior Software Architect in Percona LLC who has vast experience in software design and development with PostgreSQL. He presented a speech “A Deep Dive into PostgreSQL Indexing” and share some useful strategies how to take fully advantage of different index types that can be extremely useful for systems developers. He also emphasized that not all index types are appropirate for all circumstances; sometimes, inproper use of index can lower database performance.</p>
<h3 id="Karel-van-der-Walt"><a href="#Karel-van-der-Walt" class="headerlink" title="Karel van der Walt"></a>Karel van der Walt</h3><p><img src="/images/karel-2021.png" alt="Karel van der Walt"><br>Karel van der Walt is the principle of MentalArrow who presented a speech called “Modularizing computation via Common Table Expressions (CTEs)”, which discusses a topic to add modularized computation on top of the existing building blocks of CTEs to improve readability and testability</p>
<h3 id="Yugo-Nagata"><a href="#Yugo-Nagata" class="headerlink" title="Yugo Nagata"></a>Yugo Nagata</h3><p><img src="/images/yugo-2021.png" alt="Yugo Nagata"><br>Yugo Nagata is a software engineer and chief scientist at SRA OSS, Japan. He is a specialist in database engineering who has great interest in PostgreSQL theories and internals. He presented a speech called “PostgreSQL Internals and Incremental View Maintenance Implementation” to share a very interesting technique to update materialzied views rapidly (instead of the old REFRESH MATERIALIZED VIEW). He also explaied the internal workings of materialized views amd shared the status of his current patch proposal of “Incremental View Maintenance” feature to the PostgreSQL community.</p>
<h3 id="Cary-Huang"><a href="#Cary-Huang" class="headerlink" title="Cary Huang"></a>Cary Huang</h3><p><img src="/images/cary-2021.png" alt="Cary Huang"><br>Cary Huang is a senior software developer of HornetLab Technology in Canada. He presented a speech called “The principles behind TLS and How it protects PG” to discuss the TLS protocol in details and explain how it is the most commonly used but the least understood security protocol today.</p>
<h3 id="Muhammad-Usama"><a href="#Muhammad-Usama" class="headerlink" title="Muhammad Usama"></a>Muhammad Usama</h3><p><img src="/images/usama-2021.png" alt="Muhammad Usama"><br>Muhammad Usama is a database architect of HornetLab Technology and a major contributor to Pgpool-II. He presented a speech called “PostgreSQL HA with Pgpool-II and whats been happening in Pgpool-II lately….” to discuss the roadmap of core features of Pgpool-II with strong emphasis on High Availability (HA), in which Muhammad believed is the most critical aspect of any enterprise application.</p>
<h3 id="Asif-Rehman"><a href="#Asif-Rehman" class="headerlink" title="Asif Rehman"></a>Asif Rehman</h3><p><img src="/images/asif-2021.png" alt="Asif Rehman"><br>Asif Rehman is a senior software engineer at HornetLab Technology and he presented a speech called “PostgreSQL Replication” which explained the purpose of replication and discussed all types of replication methods with their pros and cons in different scenarios.</p>
<h3 id="Seoul-Sub-Forum"><a href="#Seoul-Sub-Forum" class="headerlink" title="Seoul Sub-Forum"></a>Seoul Sub-Forum</h3><p><img src="/images/seoul-2021.webp" alt="seoul sub forum"></p>
<p>In the Seoul sub-forum, four Korean PostgreSQL user group members gave speeches, namely Ioseph Kim, Jaegeun Yu, Daniel Lee, and Lee Jiho.</p>
<p>Ioseph Kim is a contributor to PostgreSQL11 and PostgreSQL12 and translated the PostgreSQL Korean documentation. The topic of his speech was “Peculiar SQL with PostgreSQL for application developer”. In this speech, Loseph Kim talked about the syntax of PostgreSQL’s Lateral Joins, distinct on… etc. He also introduced the new features of PostgreSQL14.</p>
<p>Jaegeun Yu has more than 3 years of experience as a PostgreSQL DBA. The topic of his speech is “Porting from Oracle UDF and Optimization”. In this speech, Jaegeun Yu talks about the basic principles of function optimization and shows how to write PostgreSQL functions efficiently while porting, and illustrate the migration process with examples.</p>
<p>Daniel Lee brought you a speech “Citus high-availability environment deployment based on Patroni”. In this speech, Daniel Lee introduced the high availability technology solution of Citus, and actually demonstrated the steps to build a Citus HA environment based on Patroni.</p>
<p>Lee Jiho is the head of the department at insignal in Korea, and has more than 20 years of experience in using PostgreSQL. Lee Jiho brought a speech “Database configuration and migration and index clustering around clusters in PostgreSQL”. In this speech, Lee Jiho introduced the changes and upgrades of Cluster, table clustering … etc.</p>
<h3 id="Jakarta-Sub-Forum"><a href="#Jakarta-Sub-Forum" class="headerlink" title="Jakarta Sub-Forum"></a>Jakarta Sub-Forum</h3><p><img src="/images/equnix-2021.webp" alt="jakarta sub forum"></p>
<p>In Jakarta sub-forum, CEO-Julyanto Sutandang and CTO-Lucky Haryadi from Equnix Business Solutions brought 3 speeches in Indonesian.</p>
<p>Equunix Business Solutions’ CEO-Julyanto Sutandang brought 2 speeches on “Active active PostgreSQL Do We Really Need It” and “In-memory Database, Is It Really Faster?”, Equunix Business Solutions CTO-Lucky Haryadi’s speech topic is “oes HA Can Help You Balance Your Load”. As a technology company with strong influence in the field of PostgreSQL and Linux in Southeast Asia, the speech brought by Equnix Business Solutions is a perfect combination of practice and theory.</p>
<p>The successful landing of this Jakarta sub-forum has greatly promoted the dissemination and development of PostgreSQL database technology in Indonesia and even Southeast Asia.</p>
<h2 id="Special-Thanks-To"><a href="#Special-Thanks-To" class="headerlink" title="Special Thanks To"></a>Special Thanks To</h2><p><img src="/images/special-thanks-2021.webp" alt="special thanks"></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2021/12/10/A-Look-Inside-PostgreSQL-s-Extended-Query-Protocol/" class="image is-7by1">
            <img class="thumbnail" src="/images/extended.png" alt="A Look Inside PostgreSQL&#39;s Extended Query Protocol">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-12-10T19:34:58.000Z">2021-12-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 983 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2021/12/10/A-Look-Inside-PostgreSQL-s-Extended-Query-Protocol/">A Look Inside PostgreSQL&#39;s Extended Query Protocol</a>
            
        </h1>
        <div class="content">
            <h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>Few weeks ago, I was tasked to have a detailed look inside PostgreSQL’s extended query protocol and study its internal mechanisms for a project that depends on this particular feature. In this blog, I will explain how extended protocol works in my own words and how it differs from simple query.</p>
<h3 id="2-Simple-Query"><a href="#2-Simple-Query" class="headerlink" title="2. Simple Query"></a>2. Simple Query</h3><p>A client is able to initiate 2 type of queries against a PostgreSQL server, simple query or extended query. Simple query, as the name suggests, is very simple and straightforward to understand. When we launch the <code>psql</code> client tool to connect to a PostgreSQLs server, almost all of the SQL commands sent are considered as simple queries. This includes the use of <code>begin</code> and <code>commit</code> to enclose a transaction, having multiple SQL queries included in one big query separated by a semicolon, executing or defining a function and much more. </p>
<p>Simple query automatically follows the standard query processing routines, which consist of these stages:</p>
<ul>
<li>Parser</li>
<li>Analyzer</li>
<li>Rewriter</li>
<li>Planner</li>
<li>Executor</li>
</ul>
<p>Refer to this blog <a href="https://www.highgo.ca/2019/10/03/trace-query-processing-internals-with-debugger/">here</a> for detailed information about query processing.</p>
<p>The communication between the client and the server is also very straightforward. In case of DML operations such as INSERT, the client sends the query to the server for processing and the server responds a <code>CommandComplete</code> message such as <code>INSERT 0 1</code> followed by a <code>ReadyForQuery(IDLE)</code> message to indicate that the server has finished the query and is now idle. The client can send another query and it follows the same patter. </p>
<p>In case of a <code>SELECT</code> query, the server will send the row description followed by the actual row data satisfying the query until there is no more rows to return. In the end, the server sends a <code>ReadyForQuery(IDLE)</code> message to indicate that the server has finished the query and is now idle.</p>
<h3 id="3-Extended-Query"><a href="#3-Extended-Query" class="headerlink" title="3. Extended Query"></a>3. Extended Query</h3><p>Extended query is the other way for the client to complete a query excepts that it breaks down the standard query processing into different steps and <code>the client</code> is responsible to ensure these steps are followed and executed correctly. The client is able to control thses steps by sending the following wire protocol message types:</p>
<ul>
<li><p>‘P’ message (Parse)</p>
<ul>
<li><code>P</code> message takes a generalize query string with data values repalced with placeholders like <code>$1</code>, <code>$2</code>, which can be later substitued with real values in the Bind step.</li>
<li>This generalized query string will be parsed via these query processing routines: <code>Parser</code> -&gt; <code>Analyzer</code> -&gt; <code>Rewriter</code></li>
<li>At the end of a successful Parse, a <code>prepared statement</code> is produced, similar to SQL’s <code>PREPARE</code> clause</li>
<li>This <code>prepared statement</code> can be <code>named</code> or <code>unnammed</code> (more on this next).</li>
<li>This <code>prepared statement</code> is just a representation of the input query and it cannot be executed yet. </li>
</ul>
</li>
<li><p>‘B’ message (Bind)</p>
<ul>
<li><code>B</code> takes the <code>named</code> or <code>unnammed</code> <code>prepared statement</code> produced from the <code>P</code> message and replaces the placeholders ($1, $2) with the user-supplied values.</li>
<li>After the values are bound to the <code>prepared statement</code>, we basically have a completed query and it will then be fed into the <code>planner</code> stage to produce the most optimized query plan for the query.</li>
<li>At the end of a successful planning, a <code>portal</code> is produced. </li>
<li>This <code>portal</code> can also be <code>named</code> or <code>unnammed</code> (more on this next)</li>
<li>A portal is basically an object that represents how to execute a particular query</li>
</ul>
</li>
<li><p>‘E’ message (Execute)</p>
<ul>
<li><code>E</code> takes the <code>named</code> or <code>unnamed</code> <code>portal</code> produced from the <code>B</code> message and actuallly launch the <code>executor</code> to execute the query (or portal).</li>
<li>resultant rows are produced (if any) and returns to the client</li>
</ul>
</li>
<li><p>‘S’ message (Sync)</p>
<ul>
<li>The client has to send a <code>S</code> message to the server to indicate the end of the extended query. </li>
<li>This message causes the server to end the current transaction and sends <code>ReadyForQuery(IDLE)</code> message back to client.</li>
</ul>
</li>
</ul>
<p>What is the purpose of separating a simple query into multiple steps? One major benefit of using the extended query is that it can save a lot of unnecessary parsing of the same query structure. Instead, we can have the common strucuture parsed only once and then bind and execute with different values multiple times.</p>
<h3 id="4-Named-and-Unnamed-Prepared-Statement-and-Portal"><a href="#4-Named-and-Unnamed-Prepared-Statement-and-Portal" class="headerlink" title="4. Named and Unnamed Prepared Statement and Portal"></a>4. Named and Unnamed Prepared Statement and Portal</h3><p>In previous section we mentioned that a prepared statement and protal can be either <code>named</code> or <code>unnamed</code> during the extended query protocol. What does it mean and what is the significance? </p>
<p>The general rule is that PostgreSQL server can only keep one unnamed prepared statement or portal. Requests containing unnamed prepared statemnt or portal will replace the existing ones. </p>
<p>With named prepared statement or portal, the server will respectively remember them based on the names given and client is able to invoke them any time or specifically destroyed by sending a Close message. </p>
<p>So, it is possible for a client to create multiple prepared statements within a transaction, each having different prepared statement names, and then bind values for them all at the same time by giving them different portal names. Eventually, the client chooses which portal to be executed.</p>
<p>More importantly, named prepared statement’s life time lasts for the entire TCP session unless explicitly destroyed; named portal lasts only until the end of transaction or when it is executed or explicitly destroyed.</p>
<p>But, does it make client implementation more complicated if extended query is used?</p>
<p>Yes, but client has a choice to complicate things or not</p>
<p>Taking libpq for example, when extended query is used, it requires the client application to provide a prepared statement name to construct the <code>P</code> (Parse) message, but does not require the client application to provide portal name to construct the <code>B</code> (Bind) message. This means that with libpq, we can send <code>P</code> message multiple times with different prepared statement names, but with <code>B</code> message, it forces to use unnamed portal name, so we always have one portal to execute. This avoids the case with multiple portal names in the client side to manage. </p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/4/">4</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/prof-img.jpg" alt="Cary Huang">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Cary Huang
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Multi-Displined Software Developer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Vancouver</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            37
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            2
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            55
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/caryhuang" target="_blank" rel="noopener">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/caryhuang">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://www.facebook.com/cary.huang.35">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.etsy.com/ca/shop/ShokuninDesignCo" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Etsy Shop</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.etsy.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.highgo.ca/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">HighGo Software Canada</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.highgo.ca</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Netsnmp/">
            <span class="level-start">
                <span class="level-item">Netsnmp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/PostgreSQL/">
            <span class="level-start">
                <span class="level-item">PostgreSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">26</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/2021-PG-Asia-Conference/" style="font-size: 12px;">2021 PG Asia Conference</a> <a href="/tags/Postgresql/" style="font-size: 18px;">Postgresql</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/atomic-commit/" style="font-size: 12px;">atomic commit</a> <a href="/tags/backend/" style="font-size: 10px;">backend</a> <a href="/tags/buffer-manager/" style="font-size: 10px;">buffer manager</a> <a href="/tags/copy/" style="font-size: 10px;">copy</a> <a href="/tags/extended-query/" style="font-size: 10px;">extended query</a> <a href="/tags/extension/" style="font-size: 10px;">extension</a> <a href="/tags/external-key-management-system/" style="font-size: 10px;">external key management system</a> <a href="/tags/failover/" style="font-size: 10px;">failover</a> <a href="/tags/fdw/" style="font-size: 12px;">fdw</a> <a href="/tags/gdb/" style="font-size: 14px;">gdb</a> <a href="/tags/in-memory/" style="font-size: 10px;">in-memory</a> <a href="/tags/in-memory-table/" style="font-size: 10px;">in-memory table</a> <a href="/tags/key-management-system/" style="font-size: 10px;">key management system</a> <a href="/tags/libpq/" style="font-size: 10px;">libpq</a> <a href="/tags/logical-decoding/" style="font-size: 10px;">logical decoding</a> <a href="/tags/logical-replication/" style="font-size: 10px;">logical replication</a> <a href="/tags/lsn/" style="font-size: 10px;">lsn</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mvcc/" style="font-size: 10px;">mvcc</a> <a href="/tags/networking/" style="font-size: 16px;">networking</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/oid/" style="font-size: 10px;">oid</a> <a href="/tags/parallel-worker/" style="font-size: 10px;">parallel worker</a> <a href="/tags/partition/" style="font-size: 10px;">partition</a> <a href="/tags/pg13/" style="font-size: 10px;">pg13</a> <a href="/tags/pg-rewind/" style="font-size: 10px;">pg_rewind</a> <a href="/tags/pitr/" style="font-size: 10px;">pitr</a> <a href="/tags/pluggable-api/" style="font-size: 10px;">pluggable api</a> <a href="/tags/pluggable-storage/" style="font-size: 14px;">pluggable storage</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/postgresql/" style="font-size: 20px;">postgresql</a> <a href="/tags/postmaster/" style="font-size: 12px;">postmaster</a> <a href="/tags/query-processing/" style="font-size: 10px;">query processing</a> <a href="/tags/recovery/" style="font-size: 12px;">recovery</a> <a href="/tags/redo/" style="font-size: 10px;">redo</a> <a href="/tags/replication/" style="font-size: 14px;">replication</a> <a href="/tags/savepoint/" style="font-size: 10px;">savepoint</a> <a href="/tags/security/" style="font-size: 16px;">security</a> <a href="/tags/sequence/" style="font-size: 10px;">sequence</a> <a href="/tags/snmp/" style="font-size: 10px;">snmp</a> <a href="/tags/streaming-replication/" style="font-size: 10px;">streaming replication</a> <a href="/tags/subtransaction/" style="font-size: 10px;">subtransaction</a> <a href="/tags/table-access-method/" style="font-size: 12px;">table access method</a> <a href="/tags/tde/" style="font-size: 10px;">tde</a> <a href="/tags/timeline-id/" style="font-size: 10px;">timeline id</a> <a href="/tags/tls/" style="font-size: 10px;">tls</a> <a href="/tags/trace/" style="font-size: 10px;">trace</a> <a href="/tags/trigger/" style="font-size: 10px;">trigger</a> <a href="/tags/visibility/" style="font-size: 10px;">visibility</a> <a href="/tags/visibility-check/" style="font-size: 10px;">visibility check</a> <a href="/tags/wal2mongo/" style="font-size: 10px;">wal2mongo</a> <a href="/tags/wire-protocol/" style="font-size: 10px;">wire protocol</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2022/10/28/Cross-partition-uniqueness-guarantee-with-global-unique-index/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/gunique.png" alt="Cross-partition uniqueness guarantee with global unique index">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2022-10-28T18:18:03.000Z">2022-10-28</time></div>
                    <a href="/2022/10/28/Cross-partition-uniqueness-guarantee-with-global-unique-index/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Cross-partition uniqueness guarantee with global unique index</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2022/09/30/How-Unique-Index-Works-In-PG-and-the-possibility-of-cross-partition-uniqueness-guarantee/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="How Unique Index Works in PG">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2022-09-30T17:10:45.000Z">2022-09-30</time></div>
                    <a href="/2022/09/30/How-Unique-Index-Works-In-PG-and-the-possibility-of-cross-partition-uniqueness-guarantee/" class="title has-link-black-ter is-size-6 has-text-weight-normal">How Unique Index Works in PG</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2022/08/05/How-to-Set-Up-NFS-and-Run-PG-on-it/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/nfs.png" alt="How to Set Up NFS and Run PG on it">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2022-08-05T18:07:43.000Z">2022-08-05</time></div>
                    <a href="/2022/08/05/How-to-Set-Up-NFS-and-Run-PG-on-it/" class="title has-link-black-ter is-size-6 has-text-weight-normal">How to Set Up NFS and Run PG on it</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2022/07/08/Maintain-a-custom-PG-to-PG-Connection-With-libpq-s-COPY-protocol/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/copy.png" alt="Maintain a custom PG to PG Connection With libpq&#39;s COPY protocol">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2022-07-08T16:45:40.000Z">2022-07-08</time></div>
                    <a href="/2022/07/08/Maintain-a-custom-PG-to-PG-Connection-With-libpq-s-COPY-protocol/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Maintain a custom PG to PG Connection With libpq&#39;s COPY protocol</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2022/06/10/Understand-PG-s-MVCC-Visibility-Check-Rules/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/visicheck.png" alt="Understand PG&#39;s MVCC Visibility Check Rules">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2022-06-10T18:13:40.000Z">2022-06-10</time></div>
                    <a href="/2022/06/10/Understand-PG-s-MVCC-Visibility-Check-Rules/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Understand PG&#39;s MVCC Visibility Check Rules</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2022/10/">
                <span class="level-start">
                    <span class="level-item">October 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/09/">
                <span class="level-start">
                    <span class="level-item">September 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/08/">
                <span class="level-start">
                    <span class="level-item">August 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/07/">
                <span class="level-start">
                    <span class="level-item">July 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/06/">
                <span class="level-start">
                    <span class="level-item">June 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/05/">
                <span class="level-start">
                    <span class="level-item">May 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/03/">
                <span class="level-start">
                    <span class="level-item">March 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/02/">
                <span class="level-start">
                    <span class="level-item">February 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2022/01/">
                <span class="level-start">
                    <span class="level-item">January 2022</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/12/">
                <span class="level-start">
                    <span class="level-item">December 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/10/">
                <span class="level-start">
                    <span class="level-item">October 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/09/">
                <span class="level-start">
                    <span class="level-item">September 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/08/">
                <span class="level-start">
                    <span class="level-item">August 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/07/">
                <span class="level-start">
                    <span class="level-item">July 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">March 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">February 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">January 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">November 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">September 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">August 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">May 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/2021-PG-Asia-Conference/">
                        <span class="tag">2021 PG Asia Conference</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Postgresql/">
                        <span class="tag">Postgresql</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/architecture/">
                        <span class="tag">architecture</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/atomic-commit/">
                        <span class="tag">atomic commit</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/backend/">
                        <span class="tag">backend</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/buffer-manager/">
                        <span class="tag">buffer manager</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/copy/">
                        <span class="tag">copy</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/extended-query/">
                        <span class="tag">extended query</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/extension/">
                        <span class="tag">extension</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/external-key-management-system/">
                        <span class="tag">external key management system</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/failover/">
                        <span class="tag">failover</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fdw/">
                        <span class="tag">fdw</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gdb/">
                        <span class="tag">gdb</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/in-memory/">
                        <span class="tag">in-memory</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/in-memory-table/">
                        <span class="tag">in-memory table</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/key-management-system/">
                        <span class="tag">key management system</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/libpq/">
                        <span class="tag">libpq</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logical-decoding/">
                        <span class="tag">logical decoding</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logical-replication/">
                        <span class="tag">logical replication</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lsn/">
                        <span class="tag">lsn</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mongodb/">
                        <span class="tag">mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mvcc/">
                        <span class="tag">mvcc</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/networking/">
                        <span class="tag">networking</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/nfs/">
                        <span class="tag">nfs</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oid/">
                        <span class="tag">oid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/parallel-worker/">
                        <span class="tag">parallel worker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/partition/">
                        <span class="tag">partition</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pg13/">
                        <span class="tag">pg13</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pg-rewind/">
                        <span class="tag">pg_rewind</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pitr/">
                        <span class="tag">pitr</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pluggable-api/">
                        <span class="tag">pluggable api</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pluggable-storage/">
                        <span class="tag">pluggable storage</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgres/">
                        <span class="tag">postgres</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgresql/">
                        <span class="tag">postgresql</span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postmaster/">
                        <span class="tag">postmaster</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/query-processing/">
                        <span class="tag">query processing</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/recovery/">
                        <span class="tag">recovery</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redo/">
                        <span class="tag">redo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/replication/">
                        <span class="tag">replication</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/savepoint/">
                        <span class="tag">savepoint</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/security/">
                        <span class="tag">security</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/sequence/">
                        <span class="tag">sequence</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/snmp/">
                        <span class="tag">snmp</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/streaming-replication/">
                        <span class="tag">streaming replication</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/subtransaction/">
                        <span class="tag">subtransaction</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/table-access-method/">
                        <span class="tag">table access method</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tde/">
                        <span class="tag">tde</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/timeline-id/">
                        <span class="tag">timeline id</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tls/">
                        <span class="tag">tls</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/trace/">
                        <span class="tag">trace</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/trigger/">
                        <span class="tag">trigger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/visibility/">
                        <span class="tag">visibility</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/visibility-check/">
                        <span class="tag">visibility check</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/wal2mongo/">
                        <span class="tag">wal2mongo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/wire-protocol/">
                        <span class="tag">wire protocol</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/Simplicity-design-logo.jpg" alt="Cary&#39;s Blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2022 Cary Huang&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://caryhuang.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>