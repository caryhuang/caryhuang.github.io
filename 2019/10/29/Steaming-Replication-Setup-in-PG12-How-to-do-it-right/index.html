<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Steaming-Replication-Setup-in-PG12-How-to-do-it-right - Cary Huang</title>


    <meta name="description" content="1. OverviewPostgreSQL 12 has been considered as a major update consisting of major performance boost with partitioning enhancements, indexing improvements, optimized planner logics and several others.">
<meta property="og:type" content="article">
<meta property="og:title" content="Steaming-Replication-Setup-in-PG12-How-to-do-it-right">
<meta property="og:url" content="http://yoursite.com/2019/10/29/Steaming-Replication-Setup-in-PG12-How-to-do-it-right/index.html">
<meta property="og:site_name" content="Cary Huang">
<meta property="og:description" content="1. OverviewPostgreSQL 12 has been considered as a major update consisting of major performance boost with partitioning enhancements, indexing improvements, optimized planner logics and several others.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/images/pg-thumbnail.png">
<meta property="article:published_time" content="2019-10-30T06:36:39.000Z">
<meta property="article:modified_time" content="2020-01-04T07:49:06.000Z">
<meta property="article:author" content="Cary Huang">
<meta property="article:tag" content="postgres">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/pg-thumbnail.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Steaming-Replication-Setup-in-PG12-How-to-do-it-right" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about/me.html">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Steaming-Replication-Setup-in-PG12-How-to-do-it-right">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-10-30T06:36:39.000Z">2019-10-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 minutes read (About 1971 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Steaming-Replication-Setup-in-PG12-How-to-do-it-right
            
        </h1>
        <div class="content">
            <h4 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h4><p>PostgreSQL 12 has been considered as a major update consisting of major performance boost with partitioning enhancements, indexing improvements, optimized planner logics and several others. One of the major changes is noticeably the removal of <code>recovery.conf</code> in a standby cluster. For this reason, the procedure to set up a streaming replication clusters has changed, and in this blog, I will demonstrate how to properly setup a streaming replication setup in PG12.</p>
<p>Streaming replication setup requires a master cluster and one or more slave clusters that will replicate the data inserted to the master by streaming the archived WAL files generated by master. The master and slaves can reside on different machines connected via network but in this blog, we will use one master and one slave setup and both will be run on the same machine with different port number.</p>
<p>The procedures illustrated in this blog is based on Postgres version 12 built from source running on Ubuntu 18.04</p>
<h4 id="2-Master-Database-Cluster-Setup"><a href="#2-Master-Database-Cluster-Setup" class="headerlink" title="2. Master Database Cluster Setup"></a>2. Master Database Cluster Setup</h4><p>Create a master database cluster using initdb tool:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ initdb &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;db-master</span><br><span class="line">$ cd &#x2F;home&#x2F;caryh&#x2F;streaming-replication</span><br></pre></td></tr></table></figure>

<p>/home/caryh/streaming-replication is the root folder to all the database clusters that we will be creating in this blog and db-master directory will be created here as a result of above commands. Let’s modify the default postgreql.conf and enable several important configuration options as shown below for streaming replication setup.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">############# db-master&#x2F;postgresql.conf #############</span><br><span class="line">wal_level &#x3D; replica</span><br><span class="line">archive_mode &#x3D; on</span><br><span class="line">max_wal_senders &#x3D; 10 </span><br><span class="line">wal_keep_segments &#x3D; 10</span><br><span class="line">hot_standby &#x3D; on</span><br><span class="line">archive_command &#x3D; &#39;test ! -f &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir&#x2F;%f &amp;&amp; cp %p &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir&#x2F;%f&#39;</span><br><span class="line">port &#x3D; 5432</span><br><span class="line">wal_log_hints &#x3D; on</span><br></pre></td></tr></table></figure>
<p>The configuration above enables Postgres to archive the WAL files in the directory /home/caryh/streaming-replication/archivedir/ when it has completed writing to a full block of WAL file or when pg_basebackup command has been issued. The %f and %p used within <code>archive_command</code> are internal to Postgres and %f will be replaced with the filename of the target WAL file and %p replaced with path to the targeted WAL file. </p>
<p>It is very important when setting the <code>archive_command</code> to ensure the WAL files are archived to a location where the slave cluster can access. </p>
<p>Please note that <code>wal_log_hints</code> must be enabled for pg_rewind tool to work properly. We will discuss more about pg_rewind in the next blog post.</p>
<p>Examine the client authentication file <code>db-master/pg_hba.conf</code> and make sure the master cluster allows replication connections from a slave cluster remotely. In my case, both my master and slave will be run on the same host, so I will leave the loopback IP address as it is. If your slave cluster is located in another machine, make sure to replace the loopback address with the right one.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">############# db-master&#x2F;pg_hba.conf #############</span><br><span class="line"># Allow replication connections from 127.0.0.1, by a user with the replication privilege.</span><br><span class="line"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span><br><span class="line">host    replication     all             127.0.0.1&#x2F;32            trust</span><br></pre></td></tr></table></figure>

<p>Let’s go ahead and start the master database cluster with the above configuration files, create a super user with permission to do replication, and a database called clusterdb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pg_ctl -D db-master start</span><br><span class="line">$ createuser cary -s --replication</span><br><span class="line">$ createdb clusterdb</span><br></pre></td></tr></table></figure>

<p>Insert some test data to the master cluster. For simplicity, we will insert 100 integers to <code>test_table</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ psql -d clusterdb -U cary -c &quot;CREATE TABLE test_table(x integer)&quot;</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;INSERT INTO test_table(x) SELECT y FROM generate_series(1, 100) a(y)&quot;</span><br><span class="line">INSERT 0 100</span><br><span class="line"></span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;SELECT count(*) from test_table&quot;</span><br><span class="line"> count </span><br><span class="line">-------</span><br><span class="line">   100</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>

<h4 id="3-Slave-Database-Cluster-Setup"><a href="#3-Slave-Database-Cluster-Setup" class="headerlink" title="3. Slave Database Cluster Setup"></a>3. Slave Database Cluster Setup</h4><p>The goal of setting up the slave cluster is to make a backup of the current master and set it up as a standby server, meaning it will stream the WAL file updates from the master and perform replication of the data.</p>
<p>Postgres provides several tools and methods to perform physical database backup. Exclusive methods such as <code>pg_start_backup(&#39;label&#39;)</code> and <code>pg_stop_backup()</code> are quite common in earlier Postgres versions. In this blog, we will use the newer, and simpler non-exclusive <code>pg_basebackup</code> fronend tool to execute the backup. There are advantages and disadvantaged for both methods and this discussion is not within the scope of this blog. This article here provides very good explaination on both methods: <a href="https://www.cybertec-postgresql.com/en/exclusive-backup-deprecated-what-now/">https://www.cybertec-postgresql.com/en/exclusive-backup-deprecated-what-now/</a></p>
<p>Let’s use pg_basebackup to create the slave cluster.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pg_basebackup -h 127.0.0.1 -U cary -p 5432 -D db-slave -P -Xs -R</span><br><span class="line">31373&#x2F;31373 kB (100%), 1&#x2F;1 tablespace</span><br></pre></td></tr></table></figure>
<p>where:<br>-h is the IP of the master cluster<br>-U is the username that is permitted to do replication<br>-p is the port number of the running master cluster<br>-D is the directory where we want to set up the slave database cluster<br>-P to show the progress<br>-Xs to select WAL streaming method<br>-R to write a recovery.conf file.</p>
<p>This step is where it would differ from the previous PG versions. The -R command will no longer output a recovery.conf file in the db-slave directory. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls db-slave</span><br><span class="line">backup_label  pg_dynshmem    pg_multixact  pg_snapshots  pg_tblspc    pg_xact</span><br><span class="line">base          pg_hba.conf    pg_notify     pg_stat       pg_twophase  postgresql.auto.conf</span><br><span class="line">global        pg_ident.conf  pg_replslot   pg_stat_tmp   PG_VERSION   postgresql.conf</span><br><span class="line">pg_commit_ts  pg_logical     pg_serial     pg_subtrans   pg_wal       standby.signal</span><br></pre></td></tr></table></figure>
<p>The contents of the old recovery.conf file are moved to <code>postgresql.conf</code> and <code>postgresql.auto.conf</code> instead.</p>
<p>Let’s examine <code>db-slave/postgresql.auto.conf</code> first, and we will see that pg_basebackup already created the <code>primary_conninfo</code> for us. This line used to be located in <code>recovery.conf</code> and it tells where and how a slave cluster should stream from the master cluster. Make sure this line is present in the <code>postgresql.auto.conf</code>. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">############# db-slave&#x2F;postgresql.auto.conf #############</span><br><span class="line"># Do not edit this file manually!</span><br><span class="line"># It will be overwritten by the ALTER SYSTEM command.</span><br><span class="line">primary_conninfo &#x3D; &#39;user&#x3D;cary passfile&#x3D;&#39;&#39;&#x2F;home&#x2F;caryh&#x2F;.pgpass&#39;&#39; host&#x3D;127.0.0.1 port&#x3D;5432 sslmode&#x3D;prefer sslcompression&#x3D;0 gssencmode&#x3D;disable target_session_attrs&#x3D;any&#39;</span><br></pre></td></tr></table></figure>

<p>Let’s examine <code>db-slave/postgresql.conf</code> and update some of the parameters.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">############# db-slave&#x2F;postgresql.conf #############</span><br><span class="line">wal_level &#x3D; replica</span><br><span class="line">archive_mode &#x3D; on</span><br><span class="line">max_wal_senders &#x3D; 10 </span><br><span class="line">wal_keep_segments &#x3D; 10</span><br><span class="line">hot_standby &#x3D; on</span><br><span class="line">archive_command &#x3D; &#39;test ! -f &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir&#x2F;%f &amp;&amp; cp %p &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir&#x2F;%f&#39;</span><br><span class="line">wal_log_hints &#x3D; on</span><br><span class="line">port &#x3D; 5433</span><br><span class="line">restore_command &#x3D; &#39;cp &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir&#x2F;%f %p&#39;</span><br><span class="line">archive_cleanup_command &#x3D; &#39;pg_archivecleanup &#x2F;home&#x2F;caryh&#x2F;streaming-replication&#x2F;archivedir %r&#39;</span><br></pre></td></tr></table></figure>

<p>Since <code>db-slave/postgresql.conf</code> is directly copied from master cluster via pg_basebackup, we will need to change the <code>port</code> to some port different (5433 in this case) from the master since both are running on the same machine. We will need to fill the <code>restore_command</code> and <code>archive_cleanup_command</code> so the slave cluster knows how to get the archived WAL files for streaming purposes. These two parameters used to be defined in <code>recovery.conf</code> and are moved to <code>postgresql.conf</code> in PG12.</p>
<p>In the db-slave directory, please note that a new <code>standby.signal</code> file is created automatically by <code>pg_basebackup</code> to indicate that this slave cluster will be run in <code>standby</code> mode. The <code>standby.signal</code> file is a new addition in PG12 to replace <code>standby_mode = &#39;on&#39;</code> that used to be defined in <code>recovery.conf</code>. If this file is not present, make sure it is created by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch db-slave&#x2F;standby.signal</span><br></pre></td></tr></table></figure>

<p>Now, let’s start the slave cluster:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pg_ctl -D db-slave start</span><br></pre></td></tr></table></figure>

<h4 id="4-Verify-the-Streaming-Replication-Setup"><a href="#4-Verify-the-Streaming-Replication-Setup" class="headerlink" title="4. Verify the Streaming Replication Setup"></a>4. Verify the Streaming Replication Setup</h4><p>Once both master and slave clusters are setup and running, we should see from the <code>ps -ef</code> command that some of the backend processes are started to achieve the replication, namely, <code>walsender</code> and <code>walreceiver</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep postgres</span><br><span class="line">caryh    12782  2921  0 16:12 ?        00:00:00 &#x2F;usr&#x2F;local&#x2F;pgsql&#x2F;bin&#x2F;postgres -D db-master</span><br><span class="line">caryh    12784 12782  0 16:12 ?        00:00:00 postgres: checkpointer   </span><br><span class="line">caryh    12785 12782  0 16:12 ?        00:00:00 postgres: background writer   </span><br><span class="line">caryh    12786 12782  0 16:12 ?        00:00:00 postgres: walwriter   </span><br><span class="line">caryh    12787 12782  0 16:12 ?        00:00:00 postgres: autovacuum launcher   </span><br><span class="line">caryh    12788 12782  0 16:12 ?        00:00:00 postgres: archiver   last was 000000010000000000000002.00000028.backup</span><br><span class="line">caryh    12789 12782  0 16:12 ?        00:00:00 postgres: stats collector   </span><br><span class="line">caryh    12790 12782  0 16:12 ?        00:00:00 postgres: logical replication launcher   </span><br><span class="line">caryh    15702  2921  0 17:06 ?        00:00:00 &#x2F;usr&#x2F;local&#x2F;pgsql&#x2F;bin&#x2F;postgres -D db-slave</span><br><span class="line">caryh    15703 15702  0 17:06 ?        00:00:00 postgres: startup   recovering 000000010000000000000003</span><br><span class="line">caryh    15708 15702  0 17:06 ?        00:00:00 postgres: checkpointer   </span><br><span class="line">caryh    15709 15702  0 17:06 ?        00:00:00 postgres: background writer   </span><br><span class="line">caryh    15711 15702  0 17:06 ?        00:00:00 postgres: stats collector   </span><br><span class="line">caryh    15713 15702  0 17:06 ?        00:00:00 postgres: walreceiver   streaming 0&#x2F;3000148</span><br><span class="line">caryh    15714 12782  0 17:06 ?        00:00:00 postgres: walsender cary 127.0.0.1(59088) streaming 0&#x2F;3000148</span><br><span class="line">caryh    15728 10962  0 17:06 pts&#x2F;5    00:00:00 grep --color&#x3D;auto post</span><br></pre></td></tr></table></figure>

<p>We can also check the replication status in details by issuing a query to the master cluster:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ psql -d clusterdb -U cary -c &quot;select * from pg_stat_replication;&quot; -x -p 5432</span><br><span class="line">-[ RECORD 1 ]----+------------------------------</span><br><span class="line">pid              | 15714</span><br><span class="line">usesysid         | 16384</span><br><span class="line">usename          | cary</span><br><span class="line">application_name | walreceiver</span><br><span class="line">client_addr      | 127.0.0.1</span><br><span class="line">client_hostname  | </span><br><span class="line">client_port      | 59088</span><br><span class="line">backend_start    | 2019-10-29 17:06:49.072082-07</span><br><span class="line">backend_xmin     | </span><br><span class="line">state            | streaming</span><br><span class="line">sent_lsn         | 0&#x2F;3000148</span><br><span class="line">write_lsn        | 0&#x2F;3000148</span><br><span class="line">flush_lsn        | 0&#x2F;3000148</span><br><span class="line">replay_lsn       | 0&#x2F;3000148</span><br><span class="line">write_lag        | </span><br><span class="line">flush_lag        | </span><br><span class="line">replay_lag       | </span><br><span class="line">sync_priority    | 0</span><br><span class="line">sync_state       | async</span><br><span class="line">reply_time       | 2019-10-29 17:10:09.515563-07</span><br></pre></td></tr></table></figure>

<p>Lastly, we can insert additional data to the master cluster and verify that slave also has the data updated.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Query slave cluster</span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;SELECT count(*) from test_table&quot; -p 5433</span><br><span class="line"> count </span><br><span class="line">-------</span><br><span class="line">   100</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"># Query master cluster</span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;SELECT count(*) from test_table&quot; -p 5432</span><br><span class="line"> count </span><br><span class="line">-------</span><br><span class="line">   100</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"># Insert more data to master cluster</span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;INSERT INTO test_table(x) SELECT y FROM generate_series(1, 100) a(y)&quot; -p 5432</span><br><span class="line">INSERT 0 100</span><br><span class="line"></span><br><span class="line"># Query slave cluster again</span><br><span class="line">psql -d clusterdb -U cary -c &quot;SELECT count(*) from test_table&quot; -p 5433</span><br><span class="line"> count </span><br><span class="line">-------</span><br><span class="line">   200</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>

<p>Both master and slave clusters are now in sync.</p>
<h4 id="5-Setup-Replication-Slots"><a href="#5-Setup-Replication-Slots" class="headerlink" title="5. Setup Replication Slots"></a>5. Setup Replication Slots</h4><p>The previous steps illustrate how to correctly setup streaming replication between a master and slave cluster. However, there may be a case where the slave can be disconnected for some reason for extended period of time and may fail to replicate with the master when some of the un-replicated WAL files are recycled or deleted from the master cluster controlled by <code>wal_keep_segments</code> parameter. </p>
<p>Replication slots ensure master can retain enough WAL segments for all slaves to receive them and prevent the master from removing rows that could cause a recovery conflict on the slaves.</p>
<p>Let’s create a replication slot on the master cluster called <code>slave</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ psql -d clusterdb -U cary -c &quot;select * from pg_create_physical_replication_slot(&#39;slave&#39;)&quot; -p 5432</span><br><span class="line"> slot_name | lsn </span><br><span class="line">-----------+-----</span><br><span class="line"> slave     | </span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">$ psql -d clusterdb -U cary -c &quot;select * from pg_replication_slots&quot; -x -p 5432</span><br><span class="line">-[ RECORD 1 ]-------+---------</span><br><span class="line">slot_name           | slave</span><br><span class="line">plugin              | </span><br><span class="line">slot_type           | physical</span><br><span class="line">datoid              | </span><br><span class="line">database            | </span><br><span class="line">temporary           | f</span><br><span class="line">active              | f</span><br><span class="line">active_pid          | </span><br><span class="line">xmin                | </span><br><span class="line">catalog_xmin        | </span><br><span class="line">restart_lsn         | </span><br><span class="line">confirmed_flush_lsn |</span><br></pre></td></tr></table></figure>

<p>We have just created replication slot on master called <code>slave</code> and it is currently not active (active = f).</p>
<p>Let’s modify slave’s <code>postgresql.conf</code> and make it connect to the master’s replication slot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">############# db-slave&#x2F;postgresql.conf #############</span><br><span class="line">primary_slot_name &#x3D; &#39;slave&#39;</span><br></pre></td></tr></table></figure>

<p>Please note that this argument <code>primary_slot_name</code> us also used to be defined in <code>recovery.conf</code> and moved to <code>postgresql.conf</code> in PG12. After the change, we are required to restart the slave.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pg_ctl -D db-slave stop</span><br><span class="line">$ pg_ctl -D db-slave start</span><br></pre></td></tr></table></figure>

<p>If all is good, checking the replication slots on master should have the slot status as active.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ psql -d clusterdb -U cary -c &quot;select * from pg_replication_slots&quot; -x -p 5432</span><br><span class="line">-[ RECORD 1 ]-------+----------</span><br><span class="line">slot_name           | slave</span><br><span class="line">plugin              | </span><br><span class="line">slot_type           | physical</span><br><span class="line">datoid              | </span><br><span class="line">database            | </span><br><span class="line">temporary           | f</span><br><span class="line">active              | t</span><br><span class="line">active_pid          | 16652</span><br><span class="line">xmin                | </span><br><span class="line">catalog_xmin        | </span><br><span class="line">restart_lsn         | 0&#x2F;3003B98</span><br><span class="line">confirmed_flush_lsn |</span><br></pre></td></tr></table></figure>

<h4 id="6-Summary"><a href="#6-Summary" class="headerlink" title="6. Summary"></a>6. Summary</h4><p>In this blog, we have discussed the updated procedures to setup streaming replication clusters in PG12, in which several steps have been changed from the older versions, particularly the removal of <code>recovery.conf</code>. </p>
<p>Here is a short list of changes related to replication setup that have been moved from <code>recovery.conf</code></p>
<ul>
<li>restore_command             =&gt; moved to <code>postgresql.conf</code></li>
<li>recovery_target_timeline    =&gt; moved to <code>postgresql.conf</code></li>
<li>standby_mode                =&gt; replaced by <code>standby.signal</code></li>
<li>primary_conninfo            =&gt; moved to <code>postgresql.conf</code> or <code>postgresql.auto.conf</code></li>
<li>archive_cleanup_command     =&gt; moved to <code>postgresql.conf</code></li>
<li>primary_slot_name           =&gt; moved to <code>postgresql.conf</code></li>
</ul>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/postgres/" rel="tag">postgres</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/">
                <span class="level-item">Replication-Failover-with-pg_rewind-in-PG12</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/prof-img.jpg" alt="Cary Huang">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Cary Huang
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Multi-Displined Software Developer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Vancouver</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            5
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Category
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            1
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tag
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            1
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/caryhuang" target="_blank" rel="noopener">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/ppoffice">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Software-Development/">
            <span class="level-start">
                <span class="level-item">Software Development</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/postgres/" style="font-size: 10px;">postgres</a>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/10/29/Steaming-Replication-Setup-in-PG12-How-to-do-it-right/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Steaming-Replication-Setup-in-PG12-How-to-do-it-right">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-30T06:36:39.000Z">2019-10-29</time></div>
                    <a href="/2019/10/29/Steaming-Replication-Setup-in-PG12-How-to-do-it-right/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Steaming-Replication-Setup-in-PG12-How-to-do-it-right</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Replication-Failover-with-pg_rewind-in-PG12">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-28T06:36:52.000Z">2019-09-27</time></div>
                    <a href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Replication-Failover-with-pg_rewind-in-PG12</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Trace-Postgres-query-processing-internals-with-debugger">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-28T06:36:24.000Z">2019-09-27</time></div>
                    <a href="/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Trace-Postgres-query-processing-internals-with-debugger</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/25/A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-26T06:36:03.000Z">2019-09-25</time></div>
                    <a href="/2019/09/25/A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres/" class="title has-link-black-ter is-size-6 has-text-weight-normal">A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/25/A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-26T05:32:25.000Z">2019-09-25</time></div>
                    <a href="/2019/09/25/A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function/" class="title has-link-black-ter is-size-6 has-text-weight-normal">A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgres/">
                        <span class="tag">postgres</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/10/29/Steaming-Replication-Setup-in-PG12-How-to-do-it-right/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Steaming-Replication-Setup-in-PG12-How-to-do-it-right">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-30T06:36:39.000Z">2019-10-29</time></div>
                    <a href="/2019/10/29/Steaming-Replication-Setup-in-PG12-How-to-do-it-right/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Steaming-Replication-Setup-in-PG12-How-to-do-it-right</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Replication-Failover-with-pg_rewind-in-PG12">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-28T06:36:52.000Z">2019-09-27</time></div>
                    <a href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Replication-Failover-with-pg_rewind-in-PG12</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="Trace-Postgres-query-processing-internals-with-debugger">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-28T06:36:24.000Z">2019-09-27</time></div>
                    <a href="/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Trace-Postgres-query-processing-internals-with-debugger</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/25/A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-26T06:36:03.000Z">2019-09-25</time></div>
                    <a href="/2019/09/25/A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres/" class="title has-link-black-ter is-size-6 has-text-weight-normal">A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/25/A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pg-thumbnail.png" alt="A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-26T05:32:25.000Z">2019-09-25</time></div>
                    <a href="/2019/09/25/A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function/" class="title has-link-black-ter is-size-6 has-text-weight-normal">A-Guide-to-Basic-Postgres-Partition-Table-and-Trigger-Function</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Software-Development/">Software Development</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgres/">
                        <span class="tag">postgres</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Steaming-Replication-Setup-in-PG12-How-to-do-it-right" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Cary Huang&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://yoursite.com',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>