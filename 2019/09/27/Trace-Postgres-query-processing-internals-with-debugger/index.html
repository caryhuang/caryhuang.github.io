<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Trace-Postgres-query-processing-internals-with-debugger - Cary&#39;s Blog</title>


    <meta name="description" content="1. OverviewIn this article we will use GDB debugger to trace the internals of Postgres and observe how an input query passes through several levels of transformation (Parser -&gt; Analyzer -&gt; Rewri">
<meta property="og:type" content="article">
<meta property="og:title" content="Trace-Postgres-query-processing-internals-with-debugger">
<meta property="og:url" content="http://caryhuang.github.io/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/index.html">
<meta property="og:site_name" content="Cary&#39;s Blog">
<meta property="og:description" content="1. OverviewIn this article we will use GDB debugger to trace the internals of Postgres and observe how an input query passes through several levels of transformation (Parser -&gt; Analyzer -&gt; Rewri">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://caryhuang.github.io/images/view4.jpg">
<meta property="article:published_time" content="2019-09-28T06:36:24.000Z">
<meta property="article:modified_time" content="2020-01-13T23:39:56.000Z">
<meta property="article:author" content="Cary Huang">
<meta property="article:tag" content="gdb">
<meta property="article:tag" content="trace">
<meta property="article:tag" content="query processing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://caryhuang.github.io/images/view4.jpg">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="Cary's Blog" type="application/atom+xml">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/Simplicity-design-logo.jpg" alt="Trace-Postgres-query-processing-internals-with-debugger" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about/me.html">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/images/view4.jpg" alt="Trace-Postgres-query-processing-internals-with-debugger">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-28T06:36:24.000Z">2019-09-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    32 minutes read (About 4769 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Trace-Postgres-query-processing-internals-with-debugger
            
        </h1>
        <div class="content">
            <h3 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h3><p>In this article we will use GDB debugger to trace the internals of Postgres and observe how an input query passes through several levels of transformation (Parser -&gt; Analyzer -&gt; Rewriter -&gt; Planner -&gt; Executor) and eventually produces an output. </p>
<p>This article is based on PG12 running on Ubuntu 18.04,  and we will use a simple <code>SELECT</code> query with <code>ORDER BY</code> , <code>GROUP BY</code>, and <code>LIMIT</code> keywords to go through the entire query processing tracing.</p>
<a id="more"></a>
<h3 id="2-Preparation"><a href="#2-Preparation" class="headerlink" title="2. Preparation"></a>2. Preparation</h3><p>GDB debugger is required to be installed to trace the internals of Postgres. Most recent distribution of Linux already comes with gdb pre-installed. If you do not have it, please install.</p>
<h4 id="2-1-Enable-Debugging-and-Disable-Compiler-Optimization-on-PG-Build"><a href="#2-1-Enable-Debugging-and-Disable-Compiler-Optimization-on-PG-Build" class="headerlink" title="2.1 Enable Debugging and Disable Compiler Optimization on PG Build"></a>2.1 Enable Debugging and Disable Compiler Optimization on PG Build</h4><p>For GDB to be useful, the postgres binaries have to be compiled with debugging symbols enabled (-g). In addition, I would suggest to turn off compiler optimization (-O0) such that while tracing we will be able to examine all memory blocks and values, and observe the execution flow properly.</p>
<p>Enable debugging using the ./configure utility in the Postgres source code repository</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> [PG_SOURCE_DIR]</span><br><span class="line">./configure --<span class="built_in">enable</span>-debug</span><br></pre></td></tr></table></figure>

<p>This will add the (-g) parameter to the CFLAGS in the main Makefile to include debugging symbols.</p>
<p>Once finished, letâ€™s disable compiler optimization by editing </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">src/Makefile.global</span><br></pre></td></tr></table></figure>
<p>Find the line where CFLAGS is defined and changed -O2 to -O0 like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CFLAGS &#x3D; -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Werror&#x3D;vla -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision&#x3D;standard -Wno-format-truncation -g -O0</span><br></pre></td></tr></table></figure>
<p>Then we need to build and install with the new Makefile</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h4 id="2-2-Initialize-Postgres-Server"><a href="#2-2-Initialize-Postgres-Server" class="headerlink" title="2.2 Initialize Postgres Server"></a>2.2 Initialize Postgres Server</h4><p>For a new build, we will need to initialize a new database</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">initDb /home/caryh/postgresql</span><br><span class="line">create user caryh</span><br><span class="line">createdb carytest</span><br></pre></td></tr></table></figure>

<p>For referencing purposes, I would suggest enable debug log for the Postgres server by modifying postgres.conf located in database home directory. In this case it is located in </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/home/caryh/postgresql/postgres.conf</span><br></pre></td></tr></table></figure>

<p>Enable the following lines in postgres.conf</p>
<figure class="highlight bash"><figcaption><span>postgres.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">log_destination = <span class="string">'syslog'</span></span><br><span class="line">syslog_facility = <span class="string">'LOCAL0'</span></span><br><span class="line">syslog_ident = <span class="string">'postgres'</span></span><br><span class="line">syslog_sequence_numbers = on</span><br><span class="line">syslog_split_messages = on</span><br><span class="line"></span><br><span class="line">debug_print_parse = on</span><br><span class="line">debug_print_rewritten = on</span><br><span class="line">debug_print_plan = on</span><br><span class="line">debug_pretty_print = on</span><br><span class="line">log_checkpoints = on</span><br><span class="line">log_connections = on</span><br><span class="line">log_disconnections = on</span><br><span class="line">log_duration = on</span><br></pre></td></tr></table></figure>

<p>Why do we enable debug log when we will be tracing postgres with gdb? This is because the output at some of the stages of query processing is represented as a complex list of structures and it is not very straightforward to print this structure unless we have written a third party print script that can help us recursively print the content of the complex structure. Postgres already has this function built-in and presented in the form of a debugging log. </p>
<h4 id="2-3-Start-Postgres-Server-and-Connect-with-Client-Tool"><a href="#2-3-Start-Postgres-Server-and-Connect-with-Client-Tool" class="headerlink" title="2.3 Start Postgres Server and Connect with Client Tool"></a>2.3 Start Postgres Server and Connect with Client Tool</h4><p>Start the PG database</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pg_ctl -D /home/caryh/postgresql start</span><br></pre></td></tr></table></figure>
<p>Connect to PG database as user</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">psql -d carytest -U cary</span><br></pre></td></tr></table></figure>

<h4 id="2-4-Populate-Example-Tables-and-Values"><a href="#2-4-Populate-Example-Tables-and-Values" class="headerlink" title="2.4 Populate Example Tables and Values"></a>2.4 Populate Example Tables and Values</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> deviceinfo (</span><br><span class="line">  serial_number <span class="built_in">varchar</span>(<span class="number">45</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  manufacturer <span class="built_in">varchar</span>(<span class="number">45</span>),</span><br><span class="line">  device_type <span class="built_in">int</span>,</span><br><span class="line">  <span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">45</span>),</span><br><span class="line">  registration_time <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> devicedata (</span><br><span class="line">  serial_number <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">REFERENCES</span> deviceinfo(serial_number),</span><br><span class="line">  record_time <span class="built_in">timestamp</span>,</span><br><span class="line">  uptime <span class="built_in">int</span>,</span><br><span class="line">  temperature <span class="built_in">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  voltage <span class="built_in">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">power</span> <span class="built_in">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">  firmware_version <span class="built_in">varchar</span>(<span class="number">45</span>),</span><br><span class="line">  configuration_file <span class="built_in">varchar</span>(<span class="number">45</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> deviceinfo <span class="keyword">VALUES</span>( <span class="string">'X00001'</span>, <span class="string">'Highgo Inc'</span>, <span class="number">1</span>, <span class="string">'password'</span>, <span class="string">'2019-09-18 16:00:00'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> deviceinfo <span class="keyword">VALUES</span>( <span class="string">'X00002'</span>, <span class="string">'Highgo Inc'</span>, <span class="number">2</span>, <span class="string">'password'</span>, <span class="string">'2019-09-18 17:00:00'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> deviceinfo <span class="keyword">VALUES</span>( <span class="string">'X00003'</span>, <span class="string">'Highgo Inc'</span>, <span class="number">1</span>, <span class="string">'password'</span>, <span class="string">'2019-09-18 18:00:00'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00001'</span>, <span class="string">'2019-09-20 16:00:00'</span>, <span class="number">2000</span>, <span class="number">38.23</span>, <span class="number">189.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00001'</span>, <span class="string">'2019-09-20 17:00:00'</span>, <span class="number">3000</span>, <span class="number">68.23</span>, <span class="number">221.00</span>, <span class="number">675.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00001'</span>, <span class="string">'2019-09-20 18:00:00'</span>, <span class="number">4000</span>, <span class="number">70.23</span>, <span class="number">220.00</span>, <span class="number">333.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00001'</span>, <span class="string">'2019-09-20 19:00:00'</span>, <span class="number">5000</span>, <span class="number">124.23</span>, <span class="number">88.00</span>, <span class="number">678.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 11:00:00'</span>, <span class="number">8000</span>, <span class="number">234.23</span>, <span class="number">567.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 12:00:00'</span>, <span class="number">9000</span>, <span class="number">56.23</span>, <span class="number">234.00</span>, <span class="number">345.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 13:00:00'</span>, <span class="number">3000</span>, <span class="number">12.23</span>, <span class="number">56.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 14:00:00'</span>, <span class="number">4000</span>, <span class="number">56.23</span>, <span class="number">77.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 11:00:00'</span>, <span class="number">8000</span>, <span class="number">234.23</span>, <span class="number">567.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 12:00:00'</span>, <span class="number">9000</span>, <span class="number">56.23</span>, <span class="number">234.00</span>, <span class="number">345.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 13:00:00'</span>, <span class="number">3000</span>, <span class="number">12.23</span>, <span class="number">56.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00002'</span>, <span class="string">'2019-09-20 14:00:00'</span>, <span class="number">4000</span>, <span class="number">56.23</span>, <span class="number">77.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 07:00:00'</span>, <span class="number">25000</span>, <span class="number">68.23</span>, <span class="number">99.00</span>, <span class="number">43.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 08:00:00'</span>, <span class="number">20600</span>, <span class="number">178.23</span>, <span class="number">333.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 09:00:00'</span>, <span class="number">20070</span>, <span class="number">5.23</span>, <span class="number">33.00</span>, <span class="number">123.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 10:00:00'</span>, <span class="number">200043</span>, <span class="number">45.23</span>, <span class="number">45.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 09:00:00'</span>, <span class="number">20070</span>, <span class="number">5.23</span>, <span class="number">33.00</span>, <span class="number">123.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> devicedata <span class="keyword">VALUES</span> (<span class="string">'X00003'</span>, <span class="string">'2019-09-20 10:00:00'</span>, <span class="number">200043</span>, <span class="number">45.23</span>, <span class="number">45.00</span>, <span class="number">456.1</span>, <span class="string">'version01'</span>, <span class="string">'config01'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-Start-gdb-Debugger"><a href="#3-Start-gdb-Debugger" class="headerlink" title="3. Start gdb Debugger"></a>3. Start gdb Debugger</h3><p>Find the PID of the connecting client PG session</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ps -ef | grep postgres</span><br><span class="line">caryh     7072  1946  0 Sep26 ?        00:00:01 /usr/<span class="built_in">local</span>/pgsql/bin/postgres -D /home/caryh/postgresql</span><br><span class="line">caryh     7074  7072  0 Sep26 ?        00:00:00 postgres: checkpointer   </span><br><span class="line">caryh     7075  7072  0 Sep26 ?        00:00:01 postgres: background writer   </span><br><span class="line">caryh     7076  7072  0 Sep26 ?        00:00:01 postgres: walwriter   </span><br><span class="line">caryh     7077  7072  0 Sep26 ?        00:00:01 postgres: autovacuum launcher   </span><br><span class="line">caryh     7078  7072  0 Sep26 ?        00:00:03 postgres: stats collector   </span><br><span class="line">caryh     7079  7072  0 Sep26 ?        00:00:00 postgres: logical replication launcher   </span><br><span class="line">caryh     7082  7072  0 Sep26 ?        00:00:00 postgres: cary carytest [<span class="built_in">local</span>] idle</span><br></pre></td></tr></table></figure>

<p>In this case it is the last line of the ps output as both my client and server reside in the same machine. Yours may be different.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">caryh     7082  7072  0 Sep26 ?        00:00:00 postgres: cary carytest [<span class="built_in">local</span>] idle</span><br></pre></td></tr></table></figure>

<p>Now we can run gdb with the postgres binary </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo gdb /usr/<span class="built_in">local</span>/pgsql/bin/postgres</span><br><span class="line">GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">"show copying"</span></span><br><span class="line">and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"x86_64-linux-gnu"</span>.</span><br><span class="line">Type <span class="string">"show configuration"</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">Type <span class="string">"apropos word"</span> to search <span class="keyword">for</span> commands related to <span class="string">"word"</span>...</span><br><span class="line">Reading symbols from /usr/<span class="built_in">local</span>/pgsql/bin/postgres...done.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Now, we can attach gdb to the PID identified in previous step</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) attach 7082</span><br><span class="line">Attaching to program: &#x2F;usr&#x2F;local&#x2F;pgsql&#x2F;bin&#x2F;postgres, process 7082</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpthread.so.0...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;.build-id&#x2F;28&#x2F;c6aade70b2d40d1f0f3d0a1a0cad1ab816448f.debug...done.</span><br><span class="line">done.</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library &quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libthread_db.so.1&quot;.</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;librt.so.1...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;librt-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl.so.2...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm.so.6...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libm-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">Reading symbols from &#x2F;lib64&#x2F;ld-linux-x86-64.so.2...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">Reading symbols from &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libnss_files.so.2...Reading symbols from &#x2F;usr&#x2F;lib&#x2F;debug&#x2F;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libnss_files-2.27.so...done.</span><br><span class="line">done.</span><br><span class="line">0x00007fce71eafb77 in epoll_wait (epfd&#x3D;4, events&#x3D;0x5633194c87e0, maxevents&#x3D;1, timeout&#x3D;-1)</span><br><span class="line">    at ..&#x2F;sysdeps&#x2F;unix&#x2F;sysv&#x2F;linux&#x2F;epoll_wait.c:30</span><br><span class="line">30  ..&#x2F;sysdeps&#x2F;unix&#x2F;sysv&#x2F;linux&#x2F;epoll_wait.c: No such file or directory.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>Upon attach, Postgres process will be put on a break and we are able to issue breakpoints command from here</p>
<h3 id="4-Start-Tracing-with-gdb"><a href="#4-Start-Tracing-with-gdb" class="headerlink" title="4. Start Tracing with gdb"></a>4. Start Tracing with gdb</h3><p><code>exec_simple_query</code> is the function that will trigger all stages of query processing. Letâ€™s put a breakpoint here.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b exec_simple_query</span><br><span class="line">Breakpoint 1 at 0x56331899a43b: file postgres.c, line 985.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br></pre></td></tr></table></figure>
<p>Now, letâ€™s type in a SELECT query with ORDER BY keywords on the postgres client connection terminal to trigger break point</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">carytest=&gt; select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;</span><br></pre></td></tr></table></figure>
<p>Breakpoint should be triggered</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Breakpoint 1, exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at postgres.c:985</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Letâ€™s do a backtrace <code>bt</code> command to see how the control got here.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) bt</span><br><span class="line">#0  exec_simple_query (query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at postgres.c:985</span><br><span class="line">#1  0x000056331899f01c in PostgresMain (argc&#x3D;1, argv&#x3D;0x5633194c89c8, dbname&#x3D;0x5633194c8890 &quot;carytest&quot;, username&#x3D;0x5633194c8878 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#2  0x00005633188fba97 in BackendRun (port&#x3D;0x5633194c0f60) at postmaster.c:4431</span><br><span class="line">#3  0x00005633188fb1ba in BackendStartup (port&#x3D;0x5633194c0f60) at postmaster.c:4122</span><br><span class="line">#4  0x00005633188f753e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#5  0x00005633188f6cd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5633194974c0) at postmaster.c:1377</span><br><span class="line">#6  0x000056331881a10f in main (argc&#x3D;3, argv&#x3D;0x5633194974c0) at main.c:228</span><br></pre></td></tr></table></figure>
<p>As you can see, PostmasterMain process is one of the early process to be started and this is where it will spawn all the backend processes and initialize the â€˜ServerLoopâ€™ to listen for client connections. When a client connets and issues some queries, the handle will be passed from the backend to <code>PostgresMain</code> and this is where the query processing will begine.</p>
<h3 id="5-Parser-Stage"><a href="#5-Parser-Stage" class="headerlink" title="5. Parser Stage"></a>5. Parser Stage</h3><p>Parser Stage is the first stage in query processing, which will take an input query string and produce a raw un-analyzed parse tree. The control will eventually come to the raw_parser function, so letâ€™s set a break point there and do a backtrace:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb)  b raw_parser</span><br><span class="line">Breakpoint 2 at 0x5633186b5bae: file parser.c, line 37.</span><br><span class="line">(gdb)  c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 2, raw_parser (str&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at parser.c:37</span><br><span class="line"></span><br><span class="line">(gdb) bt</span><br><span class="line">#0  raw_parser (str&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at parser.c:37</span><br><span class="line">#1  0x000056331899a03e in pg_parse_query ( query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at postgres.c:641</span><br><span class="line">#2  0x000056331899a4c9 in exec_simple_query ( query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at postgres.c:1037</span><br><span class="line">#3  0x000056331899f01c in PostgresMain (argc&#x3D;1, argv&#x3D;0x5633194c89c8, dbname&#x3D;0x5633194c8890 &quot;carytest&quot;,  username&#x3D;0x5633194c8878 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#4  0x00005633188fba97 in BackendRun (port&#x3D;0x5633194c0f60) at postmaster.c:4431</span><br><span class="line">#5  0x00005633188fb1ba in BackendStartup (port&#x3D;0x5633194c0f60) at postmaster.c:4122</span><br><span class="line">#6  0x00005633188f753e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#7  0x00005633188f6cd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5633194974c0) at postmaster.c:1377</span><br><span class="line">#8  0x000056331881a10f in main (argc&#x3D;3, argv&#x3D;0x5633194974c0) at main.c:228</span><br></pre></td></tr></table></figure>

<p>In <code>raw_parser</code>, 2 things will happen, first to scan the query with flex-based scanner to check keyword validity and second to do the actual parsing with bison-based parser. In the end, it will return a parse tree for next stage.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) n</span><br><span class="line">43    yyscanner &#x3D; scanner_init(str, &amp;yyextra.core_yy_extra,</span><br><span class="line">(gdb) n</span><br><span class="line">47    yyextra.have_lookahead &#x3D; false;</span><br><span class="line">(gdb) n</span><br><span class="line">50    parser_init(&amp;yyextra);</span><br><span class="line">(gdb) </span><br><span class="line">53    yyresult &#x3D; base_yyparse(yyscanner);</span><br><span class="line">(gdb) </span><br><span class="line">56    scanner_finish(yyscanner);</span><br><span class="line">(gdb) </span><br><span class="line">58    if (yyresult)       &#x2F;* error *&#x2F;</span><br><span class="line">(gdb) </span><br><span class="line">61    return yyextra.parsetree;</span><br></pre></td></tr></table></figure>

<p>It is not very straight-forward to examine the content of the parse tree stored in <code>yyextra.parsetree</code> as above. This is why we enabled postgres debug log so that we can utilize it to recursively print the content of the parse tree. The parse tree illustrated by <code>yyextra.parsetree</code> can be visualized as this image below:</p>
<p><img src="/images/parse_tree.png" alt="extension"></p>
<h3 id="6-0-Analyzer-Stage"><a href="#6-0-Analyzer-Stage" class="headerlink" title="6.0 Analyzer Stage"></a>6.0 Analyzer Stage</h3><p>Now we have a list of parse trees, size 1 in this example, PG will need to feed each item in the list into anaylzer and rewriter functions. Letâ€™s set a break point at <code>parse_analyze</code> function</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb)  b parse_analyze</span><br><span class="line">Breakpoint 3 at 0x56331867d608: file analyze.c, line 104.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 3, parse_analyze (parseTree&#x3D;0x56331949dd50,  sourceText&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;, paramTypes&#x3D;0x0, numParams&#x3D;0, queryEnv&#x3D;0x0) at analyze.c:104</span><br><span class="line">104   ParseState *pstate &#x3D; make_parsestate(NULL);</span><br><span class="line">(gdb) bt</span><br><span class="line"></span><br><span class="line">#0  parse_analyze (parseTree&#x3D;0x56331949dd50, sourceText&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;, paramTypes&#x3D;0x0, numParams&#x3D;0, queryEnv&#x3D;0x0) at analyze.c:104</span><br><span class="line">#1  0x000056331899a0a8 in pg_analyze_and_rewrite (parsetree&#x3D;0x56331949dd50, </span><br><span class="line">    query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;, </span><br><span class="line">    paramTypes&#x3D;0x0, numParams&#x3D;0, queryEnv&#x3D;0x0) at postgres.c:695</span><br><span class="line">#2  0x000056331899a702 in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;)</span><br><span class="line">    at postgres.c:1140</span><br><span class="line">#3  0x000056331899f01c in PostgresMain (argc&#x3D;1, argv&#x3D;0x5633194c89c8, </span><br><span class="line">    dbname&#x3D;0x5633194c8890 &quot;carytest&quot;, username&#x3D;0x5633194c8878 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#4  0x00005633188fba97 in BackendRun (port&#x3D;0x5633194c0f60) at postmaster.c:4431</span><br><span class="line">#5  0x00005633188fb1ba in BackendStartup (port&#x3D;0x5633194c0f60) at postmaster.c:4122</span><br><span class="line">#6  0x00005633188f753e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#7  0x00005633188f6cd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5633194974c0) at postmaster.c:1377</span><br><span class="line">#8  0x000056331881a10f in main (argc&#x3D;3, argv&#x3D;0x5633194974c0) at main.c:228</span><br></pre></td></tr></table></figure>

<p>The above backtrace shows how the control gets to parse_analyze function, and 2 vital imputs are <code>parseTree</code> (type RawStmt) and (const char) <code>sourceText</code></p>
<p>Letâ€™s traverse to the end of parse_analyze</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) n</span><br><span class="line">109   pstate-&gt;p_sourcetext &#x3D; sourceText;</span><br><span class="line">(gdb) </span><br><span class="line">111   if (numParams &gt; 0)</span><br><span class="line">(gdb) </span><br><span class="line">114   pstate-&gt;p_queryEnv &#x3D; queryEnv;</span><br><span class="line">(gdb) </span><br><span class="line">116   query &#x3D; transformTopLevelStmt(pstate, parseTree);</span><br><span class="line">(gdb) </span><br><span class="line">118   if (post_parse_analyze_hook)</span><br><span class="line">(gdb) </span><br><span class="line">121   free_parsestate(pstate);</span><br><span class="line">(gdb) </span><br><span class="line">123   return query;</span><br></pre></td></tr></table></figure>

<p>At analyzer stage, it produces a result of type <code>Query</code> and it is in fact the data type return from the parser stage as a <code>List</code> of <code>Query</code>. This structure will be fed into the rewriter stage.</p>
<h3 id="7-0-Rewriter-Stage"><a href="#7-0-Rewriter-Stage" class="headerlink" title="7.0 Rewriter Stage"></a>7.0 Rewriter Stage</h3><p>Rewriter is the next stage following analyzer, letâ€™s create a break point at <code>pg_rewrite_query</code> and do a backtrace:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b pg_rewrite_query</span><br><span class="line">Breakpoint 4 at 0x56331899a1c1: file postgres.c, line 773</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 4, pg_rewrite_query (query&#x3D;0x56331949dee0) at postgres.c:773</span><br><span class="line">773   if (Debug_print_parse)</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  pg_rewrite_query (query&#x3D;0x56331949dee0) at postgres.c:773</span><br><span class="line">#1  0x000056331899a0cf in pg_analyze_and_rewrite (parsetree&#x3D;0x56331949dd50, </span><br><span class="line">    query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;, </span><br><span class="line">    paramTypes&#x3D;0x0, numParams&#x3D;0, queryEnv&#x3D;0x0) at postgres.c:704</span><br><span class="line">#2  0x000056331899a702 in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;)</span><br><span class="line">    at postgres.c:1140</span><br><span class="line">#3  0x000056331899f01c in PostgresMain (argc&#x3D;1, argv&#x3D;0x5633194c89c8, </span><br><span class="line">    dbname&#x3D;0x5633194c8890 &quot;carytest&quot;, username&#x3D;0x5633194c8878 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#4  0x00005633188fba97 in BackendRun (port&#x3D;0x5633194c0f60) at postmaster.c:4431</span><br><span class="line">#5  0x00005633188fb1ba in BackendStartup (port&#x3D;0x5633194c0f60) at postmaster.c:4122</span><br><span class="line">#6  0x00005633188f753e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#7  0x00005633188f6cd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5633194974c0) at postmaster.c:1377</span><br><span class="line">#8  0x000056331881a10f in main (argc&#x3D;3, argv&#x3D;0x5633194974c0) at main.c:228</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Rewriter takes the output of the previou stage and returns a querytree_list of type <code>List*</code>. Letâ€™s trace the function to the end and print the output</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">773     if (Debug_print_parse)</span><br><span class="line">(gdb) n</span><br><span class="line">774     elog_node_display(LOG, &quot;parse tree&quot;, query,</span><br><span class="line">(gdb) </span><br><span class="line">777   if (log_parser_stats)</span><br><span class="line">(gdb) </span><br><span class="line">780   if (query-&gt;commandType &#x3D;&#x3D; CMD_UTILITY)</span><br><span class="line">(gdb) </span><br><span class="line">788     querytree_list &#x3D; QueryRewrite(query);</span><br><span class="line">(gdb) </span><br><span class="line">791   if (log_parser_stats)</span><br><span class="line">(gdb) </span><br><span class="line">848   if (Debug_print_rewritten)</span><br><span class="line">(gdb) </span><br><span class="line">849     elog_node_display(LOG, &quot;rewritten parse tree&quot;, querytree_list,</span><br><span class="line">(gdb) </span><br><span class="line">852   return querytree_list;</span><br></pre></td></tr></table></figure>

<p>the <code>line 774 elog_node_display</code> and <code>line 849 elog_node_display</code> are the debug print function provided by postgres to recursively print the content of <code>Query</code> before and after rewriter stage. After examining the output query tree, we found that in this example, the rewriter does not make much modification to the origianl query tree and it can be visualized as:</p>
<p><img src="/images/parse_tree.png" alt="extension"></p>
<h3 id="8-0-Planner-Stage"><a href="#8-0-Planner-Stage" class="headerlink" title="8.0 Planner Stage"></a>8.0 Planner Stage</h3><p>Planner is the next stage immediately following the previous. The main planner function entry point is <code>pg_plan_query</code> and it takes the output from previous stage as input. Letâ€™s create a breakpoint and do a backtrace again</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b pg_plan_queries</span><br><span class="line">Breakpoint 5 at 0x56331899a32d: file postgres.c, line 948.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 5, pg_plan_queries (querytrees&#x3D;0x563319558558, cursorOptions&#x3D;256, boundParams&#x3D;0x0)</span><br><span class="line">    at postgres.c:948</span><br><span class="line">948   List     *stmt_list &#x3D; NIL;</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  pg_plan_queries (querytrees&#x3D;0x563319558558, cursorOptions&#x3D;256, boundParams&#x3D;0x0) at postgres.c:948</span><br><span class="line">#1  0x000056331899a722 in exec_simple_query ( query_string&#x3D;0x56331949cf00 &quot;select * from devicedata order by serial_number desc;&quot;) at postgres.c:1143</span><br><span class="line">#2  0x000056331899f01c in PostgresMain (argc&#x3D;1, argv&#x3D;0x5633194c89c8, dbname&#x3D;0x5633194c8890 &quot;carytest&quot;, username&#x3D;0x5633194c8878 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#3  0x00005633188fba97 in BackendRun (port&#x3D;0x5633194c0f60) at postmaster.c:4431</span><br><span class="line">#4  0x00005633188fb1ba in BackendStartup (port&#x3D;0x5633194c0f60) at postmaster.c:4122</span><br><span class="line">#5  0x00005633188f753e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#6  0x00005633188f6cd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5633194974c0) at postmaster.c:1377</span><br><span class="line">#7  0x000056331881a10f in main (argc&#x3D;3, argv&#x3D;0x5633194974c0) at main.c:228</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>Now, we are here, letâ€™s trace the function until the end. Please note that for each content block in the input querytree list, the function will call a helper plan function called <code>pg_plan_query</code> and it will  perform the real plan operation there and return the result in <code>plannedStmt</code> data type</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) n</span><br><span class="line">951   foreach(query_list, querytrees)</span><br><span class="line">(gdb) n</span><br><span class="line">953     Query    *query &#x3D; lfirst_node(Query, query_list);</span><br><span class="line">(gdb) n</span><br><span class="line">956     if (query-&gt;commandType &#x3D;&#x3D; CMD_UTILITY)</span><br><span class="line">(gdb) n</span><br><span class="line">968       stmt &#x3D; pg_plan_query(query, cursorOptions, boundParams);</span><br><span class="line">(gdb) s</span><br><span class="line">pg_plan_query (querytree&#x3D;0x56331949dee0, cursorOptions&#x3D;256, boundParams&#x3D;0x0) at postgres.c:866</span><br><span class="line">866   if (querytree-&gt;commandType &#x3D;&#x3D; CMD_UTILITY)</span><br><span class="line">(gdb) n</span><br><span class="line">874   if (log_planner_stats)</span><br><span class="line">(gdb) </span><br><span class="line">878   plan &#x3D; planner(querytree, cursorOptions, boundParams);</span><br><span class="line">(gdb) n</span><br><span class="line">880   if (log_planner_stats)</span><br><span class="line">(gdb) </span><br><span class="line">929   if (Debug_print_plan)</span><br><span class="line">(gdb) </span><br><span class="line">930     elog_node_display(LOG, &quot;plan&quot;, plan, Debug_pretty_print);</span><br><span class="line">(gdb) </span><br><span class="line">934   return plan;</span><br></pre></td></tr></table></figure>

<p>Line <code>930 elog_node_display</code> will print the content of <code>PlannedStmt</code> recursively to syslog and it can be visualized as:</p>
<p><img src="/images/plan-tree2.png" alt="extension"></p>
<p>The above plan tree corresponds to the output of <code>EXPLAIN ANALYZE</code> on the same query.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">carytest=&gt; EXPLAIN ANALYZE SELECT serial_number, COUNT(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;</span><br><span class="line">                                                       QUERY PLAN                             </span><br><span class="line">                          </span><br><span class="line"><span class="comment">------------------------------------------------------------------------------------</span></span><br><span class="line"> Limit  (cost=1.32..1.33 rows=2 width=15) (actual time=0.043..0.044 rows=2 loops=1)</span><br><span class="line">   -&gt;  Sort  (cost=1.32..1.33 rows=3 width=15) (actual time=0.042..0.042 rows=2 loops=1)</span><br><span class="line">         Sort Key: (count(serial_number)) DESC</span><br><span class="line">         Sort Method: quicksort  Memory: 25kB</span><br><span class="line">         -&gt;  HashAggregate  (cost=1.27..1.30 rows=3 width=15) (actual time=0.033..0.035 rows=3</span><br><span class="line"> loops=1)</span><br><span class="line">               Group Key: serial_number</span><br><span class="line">               -&gt;  Seq Scan on devicedata  (cost=0.00..1.18 rows=18 width=7) (actual time=0.01</span><br><span class="line">3..0.016 rows=18 loops=1)</span><br><span class="line"> Planning Time: 28.541 ms</span><br><span class="line"> Execution Time: 0.097 ms</span><br><span class="line">(9 rows)</span><br></pre></td></tr></table></figure>



<p>Line <code>878 plan = planner(querytree, cursorOptions, boundParams);</code> in the above trace is the real planner logic and it is a complex stage. Inside this function, it will compute the initial cost and run time cost of all possible queries and in the end, it will choose a plan that is the least expensive. </p>
<p>with the <code>plannedStmt</code> produced, we are ready to enter the next stage of query processing.</p>
<h3 id="9-0-Executor-Stage"><a href="#9-0-Executor-Stage" class="headerlink" title="9.0 Executor Stage"></a>9.0 Executor Stage</h3><p>In addition to planner, executor is also one of the complex stages of query processing. This module is responsible for executing the query plan produced from previous stage and sending the query results back to the connecting client. </p>
<p>Executor is invoked and managed with a wrapper called <code>portal</code> and portal is an object representing the execution state of a query and providing memory management services but it does not actually run the executor. In the end, the portal will invoke one of the four executor routines as below</p>
<p>-ExecutorStart()<br>-ExecutorRun()<br>-ExecutorFinish()<br>-ExecutorEnd()</p>
<p>Before we can use the above routines, the portal needs to be initialized first. In the previous stage, the control is left at <code>exec_simple_query</code> at line 1147, letâ€™s continue tracing from here to enter portal initialization</p>
<p>Letâ€™s create a break point for each executor routine and do a back trace on each as we continue</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b ExecutorStart</span><br><span class="line">Breakpoint 6 at 0x5633187ad797: file execMain.c, line 146.</span><br><span class="line">(gdb) b ExecutorRun</span><br><span class="line">Breakpoint 7 at 0x5633187ada1e: file execMain.c, line 306.</span><br><span class="line">(gdb) b ExecutorFinish</span><br><span class="line">Breakpoint 8 at 0x5633187adc35: file execMain.c, line 405.</span><br><span class="line">(gdb) b ExecutorEnd</span><br><span class="line">Breakpoint 9 at 0x5633187add1e: file execMain.c, line 465.</span><br></pre></td></tr></table></figure>
<h4 id="9-1-Executor-Start"><a href="#9-1-Executor-Start" class="headerlink" title="9.1 Executor Start"></a>9.1 Executor Start</h4><p>The main purpose of ExecutorStart routine is to prepare the query plan, allocate storage and prepare rule manager. Letâ€™s continue the tracing and do a backtrace.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Breakpoint 6, ExecutorStart (queryDesc&#x3D;0x5633195712e0, eflags&#x3D;0) at execMain.c:146</span><br><span class="line">146   if (ExecutorStart_hook)</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  ExecutorStart (queryDesc&#x3D;0x564977500190, eflags&#x3D;0) at execMain.c:146</span><br><span class="line">#1  0x0000564975eb87e0 in PortalStart (portal&#x3D;0x5649774a18d0, params&#x3D;0x0, eflags&#x3D;0, snapshot&#x3D;0x0)</span><br><span class="line">    at pquery.c:518</span><br><span class="line">#2  0x0000564975eb27b5 in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x564977439f00 &quot;select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;&quot;) at postgres.c:1176</span><br><span class="line">#3  0x0000564975eb701c in PostgresMain (argc&#x3D;1, argv&#x3D;0x564977465a08, </span><br><span class="line">    dbname&#x3D;0x5649774658d0 &quot;carytest&quot;, username&#x3D;0x5649774658b8 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#4  0x0000564975e13a97 in BackendRun (port&#x3D;0x56497745dfa0) at postmaster.c:4431</span><br><span class="line">#5  0x0000564975e131ba in BackendStartup (port&#x3D;0x56497745dfa0) at postmaster.c:4122</span><br><span class="line">#6  0x0000564975e0f53e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#7  0x0000564975e0ecd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5649774344c0) at postmaster.c:1377</span><br><span class="line">#8  0x0000564975d3210f in main (argc&#x3D;3, argv&#x3D;0x5649774344c0) at main.c:228</span><br><span class="line"></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<h4 id="9-2-Executor-Run"><a href="#9-2-Executor-Run" class="headerlink" title="9.2 Executor Run"></a>9.2 Executor Run</h4><p>ExecutorRun is the main routine of executor module, and its main task is to execute the query plan, this routing will call the <code>ExecutePlan</code> function to actually execute the plan. In the end, before return, the result of query will be stored in <code>Estate</code> structure called <code>estate</code> and inside there is a count of how many tutples have been processed by the executor</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 7, ExecutorRun (queryDesc&#x3D;0x5633195712e0, direction&#x3D;ForwardScanDirection, count&#x3D;0, </span><br><span class="line">    execute_once&#x3D;true) at execMain.c:306</span><br><span class="line">306   if (ExecutorRun_hook)</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  ExecutorRun (queryDesc&#x3D;0x564977500190, direction&#x3D;ForwardScanDirection, count&#x3D;0, </span><br><span class="line">    execute_once&#x3D;true) at execMain.c:306</span><br><span class="line">#1  0x0000564975eb915c in PortalRunSelect (portal&#x3D;0x5649774a18d0, forward&#x3D;true, count&#x3D;0, </span><br><span class="line">    dest&#x3D;0x564977539460) at pquery.c:929</span><br><span class="line">#2  0x0000564975eb8db6 in PortalRun (portal&#x3D;0x5649774a18d0, count&#x3D;9223372036854775807, </span><br><span class="line">    isTopLevel&#x3D;true, run_once&#x3D;true, dest&#x3D;0x564977539460, altdest&#x3D;0x564977539460, </span><br><span class="line">    completionTag&#x3D;0x7ffff0b937d0 &quot;&quot;) at pquery.c:770</span><br><span class="line">#3  0x0000564975eb28ad in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x564977439f00 &quot;select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;&quot;) at postgres.c:1215</span><br><span class="line">#4  0x0000564975eb701c in PostgresMain (argc&#x3D;1, argv&#x3D;0x564977465a08, </span><br><span class="line">    dbname&#x3D;0x5649774658d0 &quot;carytest&quot;, username&#x3D;0x5649774658b8 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#5  0x0000564975e13a97 in BackendRun (port&#x3D;0x56497745dfa0) at postmaster.c:4431</span><br><span class="line">#6  0x0000564975e131ba in BackendStartup (port&#x3D;0x56497745dfa0) at postmaster.c:4122</span><br><span class="line">#7  0x0000564975e0f53e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#8  0x0000564975e0ecd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5649774344c0) at postmaster.c:1377</span><br><span class="line">#9  0x0000564975d3210f in main (argc&#x3D;3, argv&#x3D;0x5649774344c0) at main.c:228</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Continue tracing the <code>ExecutorRun</code> to the end.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">306   if (ExecutorRun_hook)</span><br><span class="line">(gdb) n</span><br><span class="line">309     standard_ExecutorRun(queryDesc, direction, count, execute_once);</span><br><span class="line">(gdb) s</span><br><span class="line">standard_ExecutorRun (queryDesc&#x3D;0x564977500190, direction&#x3D;ForwardScanDirection, count&#x3D;0, </span><br><span class="line">    execute_once&#x3D;true) at execMain.c:325</span><br><span class="line">325   estate &#x3D; queryDesc-&gt;estate;</span><br><span class="line">(gdb) n</span><br><span class="line">333   oldcontext &#x3D; MemoryContextSwitchTo(estate-&gt;es_query_cxt);</span><br><span class="line">(gdb) n</span><br><span class="line">336   if (queryDesc-&gt;totaltime)</span><br><span class="line">(gdb) n</span><br><span class="line">342   operation &#x3D; queryDesc-&gt;operation;</span><br><span class="line">(gdb) </span><br><span class="line">343   dest &#x3D; queryDesc-&gt;dest;</span><br><span class="line">(gdb) </span><br><span class="line">348   estate-&gt;es_processed &#x3D; 0;</span><br><span class="line">(gdb) </span><br><span class="line">350   sendTuples &#x3D; (operation &#x3D;&#x3D; CMD_SELECT ||</span><br><span class="line">(gdb) </span><br><span class="line">353   if (sendTuples)</span><br><span class="line">(gdb) </span><br><span class="line">354     dest-&gt;rStartup(dest, operation, queryDesc-&gt;tupDesc);</span><br><span class="line">(gdb) </span><br><span class="line">359   if (!ScanDirectionIsNoMovement(direction))</span><br><span class="line">(gdb) </span><br><span class="line">361     if (execute_once &amp;&amp; queryDesc-&gt;already_executed)</span><br><span class="line">(gdb) </span><br><span class="line">363     queryDesc-&gt;already_executed &#x3D; true;</span><br><span class="line">(gdb) </span><br><span class="line">365     ExecutePlan(estate,</span><br><span class="line">(gdb) </span><br><span class="line">367           queryDesc-&gt;plannedstmt-&gt;parallelModeNeeded,</span><br><span class="line">(gdb) </span><br><span class="line">365     ExecutePlan(estate,</span><br><span class="line">(gdb) </span><br><span class="line">379   if (sendTuples)</span><br><span class="line">(gdb) </span><br><span class="line">380     dest-&gt;rShutdown(dest);</span><br><span class="line">(gdb) </span><br><span class="line">382   if (queryDesc-&gt;totaltime)</span><br><span class="line">(gdb) </span><br><span class="line">385   MemoryContextSwitchTo(oldcontext);</span><br><span class="line">(gdb) p estate</span><br><span class="line">$6 &#x3D; (EState *) 0x56497751fbb0</span><br><span class="line">(gdb) p estate-&gt;es_processed</span><br><span class="line">$7 &#x3D; 2</span><br></pre></td></tr></table></figure>

<h4 id="9-3-Executor-Finish"><a href="#9-3-Executor-Finish" class="headerlink" title="9.3 Executor Finish"></a>9.3 Executor Finish</h4><p>ExecutorFinish must be called after the last ExecutorRun, its main task is to perform necessary clearn up actions and also fire up after Triggers. Letâ€™s trace a little further.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 8, ExecutorFinish (queryDesc&#x3D;0x5633195712e0) at execMain.c:405</span><br><span class="line">405   if (ExecutorFinish_hook)</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  ExecutorFinish (queryDesc&#x3D;0x564977500190) at execMain.c:405</span><br><span class="line">#1  0x0000564975c5b52c in PortalCleanup (portal&#x3D;0x5649774a18d0) at portalcmds.c:300</span><br><span class="line">#2  0x0000564976071ba4 in PortalDrop (portal&#x3D;0x5649774a18d0, isTopCommit&#x3D;false) at portalmem.c:499</span><br><span class="line">#3  0x0000564975eb28d3 in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x564977439f00 &quot;select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;&quot;) at postgres.c:1225</span><br><span class="line">#4  0x0000564975eb701c in PostgresMain (argc&#x3D;1, argv&#x3D;0x564977465a08, </span><br><span class="line">    dbname&#x3D;0x5649774658d0 &quot;carytest&quot;, username&#x3D;0x5649774658b8 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#5  0x0000564975e13a97 in BackendRun (port&#x3D;0x56497745dfa0) at postmaster.c:4431</span><br><span class="line">#6  0x0000564975e131ba in BackendStartup (port&#x3D;0x56497745dfa0) at postmaster.c:4122</span><br><span class="line">#7  0x0000564975e0f53e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#8  0x0000564975e0ecd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5649774344c0) at postmaster.c:1377</span><br><span class="line">#9  0x0000564975d3210f in main (argc&#x3D;3, argv&#x3D;0x5649774344c0) at main.c:228</span><br></pre></td></tr></table></figure>
<p>Continue tracing the <code>ExecutorFinish</code> to the end.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">405   if (ExecutorFinish_hook)</span><br><span class="line">(gdb) n</span><br><span class="line">408     standard_ExecutorFinish(queryDesc);</span><br><span class="line">(gdb) s</span><br><span class="line">standard_ExecutorFinish (queryDesc&#x3D;0x564977500190) at execMain.c:420</span><br><span class="line">420   estate &#x3D; queryDesc-&gt;estate;</span><br><span class="line">(gdb) n</span><br><span class="line">429   oldcontext &#x3D; MemoryContextSwitchTo(estate-&gt;es_query_cxt);</span><br><span class="line">(gdb) </span><br><span class="line">432   if (queryDesc-&gt;totaltime)</span><br><span class="line">(gdb) </span><br><span class="line">436   ExecPostprocessPlan(estate);</span><br><span class="line">(gdb) </span><br><span class="line">439   if (!(estate-&gt;es_top_eflags &amp; EXEC_FLAG_SKIP_TRIGGERS))</span><br><span class="line">(gdb) </span><br><span class="line">442   if (queryDesc-&gt;totaltime)</span><br><span class="line">(gdb) </span><br><span class="line">445   MemoryContextSwitchTo(oldcontext);</span><br><span class="line">(gdb) </span><br><span class="line">447   estate-&gt;es_finished &#x3D; true;</span><br><span class="line">(gdb) </span><br><span class="line">448 &#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-4-Executor-End"><a href="#9-4-Executor-End" class="headerlink" title="9.4 Executor End"></a>9.4 Executor End</h4><p>This routing basically resets and releases some of the state variables in <code>QueryDesc</code> used during execution. ExecutorEnd is the last routine to be called and before entry, the  <code>PortalCleanup</code> and  <code>PortalDrop</code> are invoked first. So as we are in this routine the outer <code>Portal</code> object is also performing the cleanup process.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Breakpoint 9, ExecutorEnd (queryDesc&#x3D;0x5633195712e0) at execMain.c:465</span><br><span class="line">465   if (ExecutorEnd_hook)</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  ExecutorEnd (queryDesc&#x3D;0x564977500190) at execMain.c:465</span><br><span class="line">#1  0x0000564975c5b538 in PortalCleanup (portal&#x3D;0x5649774a18d0) at portalcmds.c:301</span><br><span class="line">#2  0x0000564976071ba4 in PortalDrop (portal&#x3D;0x5649774a18d0, isTopCommit&#x3D;false) at portalmem.c:499</span><br><span class="line">#3  0x0000564975eb28d3 in exec_simple_query (</span><br><span class="line">    query_string&#x3D;0x564977439f00 &quot;select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;&quot;) at postgres.c:1225</span><br><span class="line">#4  0x0000564975eb701c in PostgresMain (argc&#x3D;1, argv&#x3D;0x564977465a08, </span><br><span class="line">    dbname&#x3D;0x5649774658d0 &quot;carytest&quot;, username&#x3D;0x5649774658b8 &quot;cary&quot;) at postgres.c:4249</span><br><span class="line">#5  0x0000564975e13a97 in BackendRun (port&#x3D;0x56497745dfa0) at postmaster.c:4431</span><br><span class="line">#6  0x0000564975e131ba in BackendStartup (port&#x3D;0x56497745dfa0) at postmaster.c:4122</span><br><span class="line">#7  0x0000564975e0f53e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#8  0x0000564975e0ecd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5649774344c0) at postmaster.c:1377</span><br><span class="line">#9  0x0000564975d3210f in main (argc&#x3D;3, argv&#x3D;0x5649774344c0) at main.c:228</span><br><span class="line"></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Letâ€™s Continue tracing <code>ExecutorEnd</code> to the end.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">465   if (ExecutorEnd_hook)</span><br><span class="line">(gdb) n</span><br><span class="line">468     standard_ExecutorEnd(queryDesc);</span><br><span class="line">(gdb) s</span><br><span class="line">standard_ExecutorEnd (queryDesc&#x3D;0x564977500190) at execMain.c:480</span><br><span class="line">480   estate &#x3D; queryDesc-&gt;estate;</span><br><span class="line">(gdb) n</span><br><span class="line">495   oldcontext &#x3D; MemoryContextSwitchTo(estate-&gt;es_query_cxt);</span><br><span class="line">(gdb) </span><br><span class="line">497   ExecEndPlan(queryDesc-&gt;planstate, estate);</span><br><span class="line">(gdb) </span><br><span class="line">500   UnregisterSnapshot(estate-&gt;es_snapshot);</span><br><span class="line">(gdb) </span><br><span class="line">501   UnregisterSnapshot(estate-&gt;es_crosscheck_snapshot);</span><br><span class="line">(gdb) </span><br><span class="line">506   MemoryContextSwitchTo(oldcontext);</span><br><span class="line">(gdb) </span><br><span class="line">512   FreeExecutorState(estate);</span><br><span class="line">(gdb) </span><br><span class="line">515   queryDesc-&gt;tupDesc &#x3D; NULL;</span><br><span class="line">(gdb) </span><br><span class="line">516   queryDesc-&gt;estate &#x3D; NULL;</span><br><span class="line">(gdb) </span><br><span class="line">517   queryDesc-&gt;planstate &#x3D; NULL;</span><br><span class="line">(gdb) </span><br><span class="line">518   queryDesc-&gt;totaltime &#x3D; NULL;</span><br><span class="line">(gdb) </span><br><span class="line">519 &#125;</span><br></pre></td></tr></table></figure>

<p>This routine marks the end of the query processing stages, the control will be passed back to <code>exec_simple_query</code> to finish the transaction and present result back to the client.</p>
<h3 id="10-0-Presenting-the-Result-Back-to-Client"><a href="#10-0-Presenting-the-Result-Back-to-Client" class="headerlink" title="10.0 Presenting the Result Back to Client"></a>10.0 Presenting the Result Back to Client</h3><p>With the transaction ended, the  <code>send_ready_for_query</code> flag will be set, and the control is now able to enter <code>ReadyForQuery</code> to present the result to client.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b ReadyForQuery</span><br><span class="line">Breakpoint 10 at 0x56331899811d: file dest.c, line 251.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 10, ReadyForQuery (dest&#x3D;DestRemote) at dest.c:251</span><br><span class="line">251 &#123;</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  ReadyForQuery (dest&#x3D;DestRemote) at dest.c:251</span><br><span class="line">#1  0x0000564975eb6eee in PostgresMain (argc&#x3D;1, argv&#x3D;0x564977465a08, </span><br><span class="line">    dbname&#x3D;0x5649774658d0 &quot;carytest&quot;, username&#x3D;0x5649774658b8 &quot;cary&quot;) at postgres.c:4176</span><br><span class="line">#2  0x0000564975e13a97 in BackendRun (port&#x3D;0x56497745dfa0) at postmaster.c:4431</span><br><span class="line">#3  0x0000564975e131ba in BackendStartup (port&#x3D;0x56497745dfa0) at postmaster.c:4122</span><br><span class="line">#4  0x0000564975e0f53e in ServerLoop () at postmaster.c:1704</span><br><span class="line">#5  0x0000564975e0ecd4 in PostmasterMain (argc&#x3D;3, argv&#x3D;0x5649774344c0) at postmaster.c:1377</span><br><span class="line">#6  0x0000564975d3210f in main (argc&#x3D;3, argv&#x3D;0x5649774344c0) at main.c:228</span><br><span class="line"></span><br><span class="line">(gdb) n</span><br><span class="line">252   switch (dest)</span><br><span class="line">(gdb) </span><br><span class="line">257       if (PG_PROTOCOL_MAJOR(FrontendProtocol) &gt;&#x3D; 3)</span><br><span class="line">(gdb) </span><br><span class="line">261         pq_beginmessage(&amp;buf, &#39;Z&#39;);</span><br><span class="line">(gdb) </span><br><span class="line">262         pq_sendbyte(&amp;buf, TransactionBlockStatusCode());</span><br><span class="line">(gdb) </span><br><span class="line">263         pq_endmessage(&amp;buf);</span><br><span class="line">(gdb) p dest</span><br><span class="line">$90 &#x3D; DestRemote</span><br><span class="line">(gdb)  n</span><br><span class="line">268       pq_flush();</span><br><span class="line">(gdb) </span><br><span class="line">269       break;</span><br><span class="line">(gdb) </span><br><span class="line">282 &#125;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>as <code>pq_flush()</code> is called, the result of the query will be returned back to the client at remote destination.</p>
<h4 id="10-1-Client-Results"><a href="#10-1-Client-Results" class="headerlink" title="10.1 Client Results"></a>10.1 Client Results</h4><p>Client will now see the output below as a result of the query</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">carytest=&gt; select serial_number, count(serial_number) from devicedata GROUP BY serial_number ORDER BY count DESC LIMIT 2;</span><br><span class="line"> serial_number | count </span><br><span class="line"><span class="comment">---------------+-------</span></span><br><span class="line"> X00002        |     8</span><br><span class="line"> X00003        |     6</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>

<h3 id="11-Summary"><a href="#11-Summary" class="headerlink" title="11 Summary"></a>11 Summary</h3><p>So far, we have traced through severl stags of query processing. Namely</p>
<ul>
<li>Parser</li>
<li>Analyzer</li>
<li>Rewritter</li>
<li>Planner</li>
<li>Executor</li>
</ul>
<p>To summarize all the above, I have created a simple call hierarchy ( or a list of breakpoints) below that outlines the important core functions that will be called while stepping through the above stages. The â€˜bâ€™ in front of each function name corresponds to the break point command of gdb.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## Main Entry ##</span><br><span class="line">b exec_simple_query</span><br><span class="line"></span><br><span class="line">  ## Parser ##</span><br><span class="line">  b pg_parse_query            -&gt; returns (List* of Query)</span><br><span class="line">    b raw_parser              -&gt; returns (List* of Query)</span><br><span class="line">      b base_yyparse          -&gt; returns (List* of Query)</span><br><span class="line">  </span><br><span class="line">  ## Analzyer and Rewritter ##</span><br><span class="line">  b pg_analyze_and_rewrite    -&gt; returns (List*)</span><br><span class="line">    b parse_analyze           -&gt; returns (Query*)</span><br><span class="line">    b pg_rewrite_query        -&gt; returns (List* of Query)   </span><br><span class="line">      b QueryRewrite          -&gt; returns (List* of Query)   </span><br><span class="line"></span><br><span class="line">  ## Planner ##</span><br><span class="line">  b pg_plan_queries           -&gt; returns (List* of plannedStmt)</span><br><span class="line">    b pg_plan_query           -&gt; returns (PlannedStmt*)</span><br><span class="line">      b planner               -&gt; returns (PlannedStmt*)</span><br><span class="line"></span><br><span class="line">  ## Executor ##</span><br><span class="line">  b PortalStart               -&gt; returns void</span><br><span class="line">    b ExecutorStart           -&gt; returns void</span><br><span class="line"></span><br><span class="line">  b PortalRun                 -&gt; returns bool</span><br><span class="line">    b PortalRunSelect         -&gt; returns uint64 </span><br><span class="line">      b ExecutorRun           -&gt; returns void</span><br><span class="line"></span><br><span class="line">  b PortalDrop                -&gt; returns void</span><br><span class="line">    b PortalCleanup           -&gt; returns void</span><br><span class="line">      b ExecutorFinish        -&gt; returns void</span><br><span class="line">      b ExecutorEnd           -&gt; returns void</span><br><span class="line"></span><br><span class="line">  ## Present Result ##</span><br><span class="line">b ReadyForQuery               -&gt; returns void</span><br><span class="line">  b pq_flush                  -&gt; returns void</span><br></pre></td></tr></table></figure>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/gdb/" rel="tag">gdb</a>, <a class="has-link-grey -link" href="/tags/query-processing/" rel="tag">query processing</a>, <a class="has-link-grey -link" href="/tags/trace/" rel="tag">trace</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/09/27/Replication-Failover-with-pg-rewind-in-PG12/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Replication-Failover-with-pg_rewind-in-PG12</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/09/25/A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres/">
                <span class="level-item">A-Guide-to-Create-User-Defined-Extension-Modules-to-Postgres</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en/sdk.js#xfbml=1&version=v2.8";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-comments" data-width="100%" data-href="http://caryhuang.github.io/2019/09/27/Trace-Postgres-query-processing-internals-with-debugger/" data-num-posts="5"></div>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/prof-img.jpg" alt="Cary Huang">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Cary Huang
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Multi-Displined Software Developer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Vancouver</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            28
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            2
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            46
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/caryhuang" target="_blank" rel="noopener">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/caryhuang">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://www.facebook.com/cary.huang.35">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.etsy.com/ca/shop/ShokuninDesignCo" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Etsy Shop</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.etsy.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.highgo.ca/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">HighGo Software Canada</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.highgo.ca</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Netsnmp/">
            <span class="level-start">
                <span class="level-item">Netsnmp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/PostgreSQL/">
            <span class="level-start">
                <span class="level-item">PostgreSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">26</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/2021-PG-Asia-Conference/" style="font-size: 10px;">2021 PG Asia Conference</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/backend/" style="font-size: 10px;">backend</a> <a href="/tags/buffer-manager/" style="font-size: 10px;">buffer manager</a> <a href="/tags/extended-query/" style="font-size: 10px;">extended query</a> <a href="/tags/extension/" style="font-size: 10px;">extension</a> <a href="/tags/external-key-management-system/" style="font-size: 10px;">external key management system</a> <a href="/tags/failover/" style="font-size: 10px;">failover</a> <a href="/tags/fdw/" style="font-size: 10px;">fdw</a> <a href="/tags/gdb/" style="font-size: 15px;">gdb</a> <a href="/tags/in-memory/" style="font-size: 10px;">in-memory</a> <a href="/tags/in-memory-table/" style="font-size: 10px;">in-memory table</a> <a href="/tags/key-management-system/" style="font-size: 10px;">key management system</a> <a href="/tags/logical-decoding/" style="font-size: 10px;">logical decoding</a> <a href="/tags/logical-replication/" style="font-size: 10px;">logical replication</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/networking/" style="font-size: 17.5px;">networking</a> <a href="/tags/oid/" style="font-size: 10px;">oid</a> <a href="/tags/parallel-worker/" style="font-size: 10px;">parallel worker</a> <a href="/tags/partition/" style="font-size: 10px;">partition</a> <a href="/tags/pg13/" style="font-size: 10px;">pg13</a> <a href="/tags/pg-rewind/" style="font-size: 10px;">pg_rewind</a> <a href="/tags/pitr/" style="font-size: 10px;">pitr</a> <a href="/tags/pluggable-api/" style="font-size: 10px;">pluggable api</a> <a href="/tags/pluggable-storage/" style="font-size: 15px;">pluggable storage</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/postgresql/" style="font-size: 20px;">postgresql</a> <a href="/tags/postmaster/" style="font-size: 12.5px;">postmaster</a> <a href="/tags/query-processing/" style="font-size: 10px;">query processing</a> <a href="/tags/recovery/" style="font-size: 12.5px;">recovery</a> <a href="/tags/replication/" style="font-size: 15px;">replication</a> <a href="/tags/savepoint/" style="font-size: 10px;">savepoint</a> <a href="/tags/security/" style="font-size: 17.5px;">security</a> <a href="/tags/sequence/" style="font-size: 10px;">sequence</a> <a href="/tags/snmp/" style="font-size: 10px;">snmp</a> <a href="/tags/streaming-replication/" style="font-size: 10px;">streaming replication</a> <a href="/tags/subtransaction/" style="font-size: 10px;">subtransaction</a> <a href="/tags/table-access-method/" style="font-size: 12.5px;">table access method</a> <a href="/tags/tde/" style="font-size: 10px;">tde</a> <a href="/tags/timeline-id/" style="font-size: 10px;">timeline id</a> <a href="/tags/tls/" style="font-size: 10px;">tls</a> <a href="/tags/trace/" style="font-size: 10px;">trace</a> <a href="/tags/trigger/" style="font-size: 10px;">trigger</a> <a href="/tags/visibility/" style="font-size: 10px;">visibility</a> <a href="/tags/wal2mongo/" style="font-size: 10px;">wal2mongo</a> <a href="/tags/wire-protocol/" style="font-size: 10px;">wire protocol</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2021/12/10/A-Look-Inside-PostgreSQL-s-Extended-Query-Protocol/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/extended.png" alt="A Look Inside PostgreSQL&#39;s Extended Query Protocol">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-12-10T19:34:58.000Z">2021-12-10</time></div>
                    <a href="/2021/12/10/A-Look-Inside-PostgreSQL-s-Extended-Query-Protocol/" class="title has-link-black-ter is-size-6 has-text-weight-normal">A Look Inside PostgreSQL&#39;s Extended Query Protocol</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/10/29/The-PostgreSQL-Timeline-Concept/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/timeline.png" alt="The PostgreSQL Timeline Concept">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-10-29T16:46:01.000Z">2021-10-29</time></div>
                    <a href="/2021/10/29/The-PostgreSQL-Timeline-Concept/" class="title has-link-black-ter is-size-6 has-text-weight-normal">The PostgreSQL Timeline Concept</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/10/25/PostgresConf-CN-and-PGConf-Asia-2021-China-Branch-Join-Forces-Again-to-Bring-You-the-Best/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/title-conference-en.jpg" alt="PostgresConf.CN and PGConf.Asia 2021 (China Branch) Join Forces Again to Bring You the Best!">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-10-25T17:25:12.000Z">2021-10-25</time></div>
                    <a href="/2021/10/25/PostgresConf-CN-and-PGConf-Asia-2021-China-Branch-Join-Forces-Again-to-Bring-You-the-Best/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PostgresConf.CN and PGConf.Asia 2021 (China Branch) Join Forces Again to Bring You the Best!</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/10/01/Set-up-PostgreSQL-Continuous-archiving-and-Perform-Point-In-Time-Recovery/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/pitr.png" alt="PostgreSQL 14 Continuous archiving and Point In Time Recovery Tutorial">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-10-01T18:33:13.000Z">2021-10-01</time></div>
                    <a href="/2021/10/01/Set-up-PostgreSQL-Continuous-archiving-and-Perform-Point-In-Time-Recovery/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PostgreSQL 14 Continuous archiving and Point In Time Recovery Tutorial</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/09/03/How-to-Implement-Foreign-Scan-With-FDW-Interface-API/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/fdw-foreign.png" alt="Implement Foreign Scan With FDW Interface API">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-09-03T16:47:45.000Z">2021-09-03</time></div>
                    <a href="/2021/09/03/How-to-Implement-Foreign-Scan-With-FDW-Interface-API/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Implement Foreign Scan With FDW Interface API</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/PostgreSQL/">PostgreSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/12/">
                <span class="level-start">
                    <span class="level-item">December 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/10/">
                <span class="level-start">
                    <span class="level-item">October 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/09/">
                <span class="level-start">
                    <span class="level-item">September 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/08/">
                <span class="level-start">
                    <span class="level-item">August 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/07/">
                <span class="level-start">
                    <span class="level-item">July 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">March 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">February 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">January 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">November 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">September 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">August 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">May 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/2021-PG-Asia-Conference/">
                        <span class="tag">2021 PG Asia Conference</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/architecture/">
                        <span class="tag">architecture</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/backend/">
                        <span class="tag">backend</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/buffer-manager/">
                        <span class="tag">buffer manager</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/extended-query/">
                        <span class="tag">extended query</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/extension/">
                        <span class="tag">extension</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/external-key-management-system/">
                        <span class="tag">external key management system</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/failover/">
                        <span class="tag">failover</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fdw/">
                        <span class="tag">fdw</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gdb/">
                        <span class="tag">gdb</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/in-memory/">
                        <span class="tag">in-memory</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/in-memory-table/">
                        <span class="tag">in-memory table</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/key-management-system/">
                        <span class="tag">key management system</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logical-decoding/">
                        <span class="tag">logical decoding</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logical-replication/">
                        <span class="tag">logical replication</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mongodb/">
                        <span class="tag">mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/networking/">
                        <span class="tag">networking</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oid/">
                        <span class="tag">oid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/parallel-worker/">
                        <span class="tag">parallel worker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/partition/">
                        <span class="tag">partition</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pg13/">
                        <span class="tag">pg13</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pg-rewind/">
                        <span class="tag">pg_rewind</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pitr/">
                        <span class="tag">pitr</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pluggable-api/">
                        <span class="tag">pluggable api</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pluggable-storage/">
                        <span class="tag">pluggable storage</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgres/">
                        <span class="tag">postgres</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postgresql/">
                        <span class="tag">postgresql</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postmaster/">
                        <span class="tag">postmaster</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/query-processing/">
                        <span class="tag">query processing</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/recovery/">
                        <span class="tag">recovery</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/replication/">
                        <span class="tag">replication</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/savepoint/">
                        <span class="tag">savepoint</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/security/">
                        <span class="tag">security</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/sequence/">
                        <span class="tag">sequence</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/snmp/">
                        <span class="tag">snmp</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/streaming-replication/">
                        <span class="tag">streaming replication</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/subtransaction/">
                        <span class="tag">subtransaction</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/table-access-method/">
                        <span class="tag">table access method</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tde/">
                        <span class="tag">tde</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/timeline-id/">
                        <span class="tag">timeline id</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/tls/">
                        <span class="tag">tls</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/trace/">
                        <span class="tag">trace</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/trigger/">
                        <span class="tag">trigger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/visibility/">
                        <span class="tag">visibility</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/wal2mongo/">
                        <span class="tag">wal2mongo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/wire-protocol/">
                        <span class="tag">wire protocol</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/Simplicity-design-logo.jpg" alt="Trace-Postgres-query-processing-internals-with-debugger" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Cary Huang&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://caryhuang.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>